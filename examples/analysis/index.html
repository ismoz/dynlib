
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python library for simulating dynamical systems.">
      
      
        <meta name="author" content="İsmail Öztürk">
      
      
        <link rel="canonical" href="https://ismoz.github.io/dynlib/examples/analysis/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../plotting/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../tr/examples/analysis/" hreflang="tr">
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Analysis catalog - dynlib</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#analysis-examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="dynlib" class="md-header__button md-logo" aria-label="dynlib" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dynlib
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis catalog
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../tr/examples/analysis/" hreflang="tr" class="md-select__link">
              Türkçe
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project/changelog/" class="md-tabs__link">
          
  
  
  Project

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="dynlib" class="md-nav__button md-logo" aria-label="dynlib" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dynlib
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started with dynlib
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/first-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Your First Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/cli/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Modeling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Modeling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Modeling guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/dsl-basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DSL basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/equations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Equations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/math-and-macros/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Math & macros
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/ternary-if/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ternary if
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/model-registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/aux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auxiliary variables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DSL functions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/lagging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lagging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/inline-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inline models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/config-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config file
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/mods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/presets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Presets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/modeling/sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simulation defaults
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Simulation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Simulation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simulation guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/jit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Just-In-Time compilation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/presets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Presets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/runner-variants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runner variants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/session-introspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Session introspection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/steppers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Steppers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/snapshots-and-resume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snapshots & resume
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/wrapper-and-runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wrapper & runner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/simulation/export-sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exporting sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Plotting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plotting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plotting guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plotting basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/decorations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decorations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exporting plots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/cobweb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cobweb plots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/basin-plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basin plots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/vectorfields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/manifold-plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manifold plots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/themes-and-facets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Themes & facets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/plotting/bifurcation-diagrams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bifurcation diagrams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Analysis
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Analysis
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analysis guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/observers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime observers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/lyapunov/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lyapunov analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/sweep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sweep utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/post-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Post-analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/fixed-points/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fixed points
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/basin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basin analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/bifurcation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bifurcation diagrams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/analysis/manifold/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Manifold analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Analysis catalog
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Analysis catalog
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basin-mapping-and-classification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basin mapping and classification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basin mapping and classification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#henon-map-basin-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Henon map basin discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basin-of-known-attractors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basin of known attractors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-cycle-basins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Limit-cycle basins
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#refinement-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      
        Refinement benchmark
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lyapunov-exponents-and-spectral-sweeps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lyapunov exponents and spectral sweeps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lyapunov exponents and spectral sweeps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logistic-map-lyapunov-demo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logistic-map Lyapunov demo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lorenz-system-lyapunov-demo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lorenz-system Lyapunov demo
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-sweeps-with-lyapunov-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter sweeps with Lyapunov statistics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manifolds-and-orbit-finders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manifolds and orbit finders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Manifolds and orbit finders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manifold-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manifold tracing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#homoclinic-heteroclinic-finders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Homoclinic &amp; heteroclinic finders
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sweeps-and-trajectory-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sweeps and trajectory helpers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sweeps and trajectory helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameter-sweeps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter sweeps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trajectory-analyzer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trajectory analyzer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plotting catalog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime catalog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    State management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bifurcation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bifurcation logistic map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integer-map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Collatz conjecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../izhikevich/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Izhikevich neuron
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Built-in models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project/issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project/todo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TODO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="analysis-examples">Analysis examples</h1>
<h2 id="overview">Overview</h2>
<p>The <code>examples/analysis/</code> folder showcases how to apply dynlib's diagnostic and geometric toolkits. You will find scripts that (1) map basins of attraction with persistence or targeted classifiers, (2) compute Lyapunov exponents and spectra, (3) trace stable/unstable manifolds and homoclinic/heteroclinic orbits, and (4) sweep parameters while atomically analyzing every recorded trajectory.</p>
<h2 id="basin-mapping-and-classification">Basin mapping and classification</h2>
<h3 id="henon-map-basin-discovery">Henon map basin discovery</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="sd">Auto basin of attraction calculation for the Henon Map.</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">Demonstrates the basin_auto function (Persistent Cell-Recurrence Basin Mapping algorithm)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="sd">to identify basins of attraction for the 2D Henon map.</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="sd">basin_auto tries to automatically discover attractors and their basins. Its success highly</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="sd">depends on the choice of parameters and the nature of the dynamical system. </span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">basin_auto</span><span class="p">,</span> <span class="n">print_basin_summary</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">basin_plot</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Timer</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="c1"># Setup Henon map model</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up Henon map model...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/henon&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1"># Set standard Henon parameters</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">a_param</span> <span class="o">=</span> <span class="mf">1.4</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">b_param</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a_param</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_param</span><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameters: a=</span><span class="si">{</span><span class="n">a_param</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State variables: x, y&quot;</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="c1"># Domain for basin calculation</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="c1"># Focusing on a region near the Henon attractor</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="c1"># Grid resolution (increase for higher detail)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="n">grid_nx</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="n">grid_ny</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Grid size: </span><span class="si">{</span><span class="n">grid_nx</span><span class="si">}</span><span class="s2"> × </span><span class="si">{</span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">grid_nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> points&quot;</span><span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Domain: x ∈ [</span><span class="si">{</span><span class="n">x_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x_max</span><span class="si">}</span><span class="s2">], y ∈ [</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="c1"># Compute basin of attraction</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing basin of attraction...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Algorithm: PCR-BM (Persistent Cell-Recurrence Basin Mapping)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Grid size: </span><span class="si">{</span><span class="n">grid_nx</span><span class="si">}</span><span class="s2"> × </span><span class="si">{</span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">grid_nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> points&quot;</span><span class="p">)</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Domain: x ∈ [</span><span class="si">{</span><span class="n">x_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x_max</span><span class="si">}</span><span class="s2">], y ∈ [</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="k">with</span> <span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;Basin computation time&quot;</span><span class="p">):</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">basin_auto</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>        <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>        <span class="n">ic_grid</span><span class="o">=</span><span class="p">[</span><span class="n">grid_nx</span><span class="p">,</span> <span class="n">grid_ny</span><span class="p">],</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>        <span class="n">ic_bounds</span><span class="o">=</span><span class="p">[(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)],</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>        <span class="n">observe_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span>  <span class="c1"># Use both state variables</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>        <span class="n">grid_res</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>  <span class="c1"># Cell resolution for recurrence detection</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>        <span class="n">merge_downsample</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>        <span class="n">post_detect_samples</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>        <span class="n">max_samples</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>  <span class="c1"># Number of iterations per initial condition</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>        <span class="n">transient_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>  <span class="c1"># Skip initial transient</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>        <span class="n">window</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>  <span class="c1"># Recurrence detection window size</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>        <span class="n">u_th</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>  <span class="c1"># Uniqueness threshold</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>        <span class="n">recur_windows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Required recurrence windows</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>        <span class="n">s_merge</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># Similarity threshold for merging attractors</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>        <span class="n">p_in</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="c1"># Persistence threshold</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>        <span class="n">b_max</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>  <span class="c1"># Blowup threshold (lower to catch diverging trajectories)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>        <span class="n">outside_limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Maximum consecutive outside steps</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>        <span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>    <span class="p">)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="c1"># Analyze results</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="n">print_basin_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="c1"># Visualization</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating visualization...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="n">theme</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="c1"># Create figure</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="n">basin_plot</span><span class="p">(</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>    <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>    <span class="n">ylabel_rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>    <span class="n">ypad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Basin of Attraction - Henon Map (a=</span><span class="si">{</span><span class="n">a_param</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b_param</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>    <span class="n">titlepad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Visualization complete!&quot;</span><span class="p">)</span>
</code></pre></div>
Runs <code>basin_auto</code> on the built-in Henon map with a 512×512 grid, PCR-BM detection across both <code>x</code>/<code>y</code>, and timer instrumentation. The script prints attractor metadata, summarizes the result, and then hands the <code>BasinResult</code> to <code>basin_plot</code> so you can see how the automatic fingerprinting divides the plane.</p>
<h3 id="basin-of-known-attractors">Basin of known attractors</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="sd">Basin of Attraction for Henon Map using Known Attractors.</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="sd">Demonstrates the simplified basin_known function to identify basins for the</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="sd">2D Henon map. basin_known requires reference(s) of the attractor(s) to be </span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="sd">provided beforehand.</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">basin_known</span><span class="p">,</span> <span class="n">print_basin_summary</span><span class="p">,</span> <span class="n">ReferenceRun</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">basin_plot</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Timer</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1"># Setup Henon map model</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up Henon map model...&quot;</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/henon&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="c1"># Set standard Henon parameters</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="n">a_param</span> <span class="o">=</span> <span class="mf">1.4</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="n">b_param</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a_param</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_param</span><span class="p">)</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameters: a=</span><span class="si">{</span><span class="n">a_param</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State variables: x, y&quot;</span><span class="p">)</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="c1"># Define grid of initial conditions</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating initial condition grid...&quot;</span><span class="p">)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="c1"># Domain for basin calculation (region near Henon attractor)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="c1"># Grid resolution</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="n">grid_nx</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="n">grid_ny</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Grid size: </span><span class="si">{</span><span class="n">grid_nx</span><span class="si">}</span><span class="s2"> × </span><span class="si">{</span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">grid_nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grid_ny</span><span class="si">}</span><span class="s2"> points&quot;</span><span class="p">)</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Domain: x ∈ [</span><span class="si">{</span><span class="n">x_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x_max</span><span class="si">}</span><span class="s2">], y ∈ [</span><span class="si">{</span><span class="n">y_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_max</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="c1"># Compute basin of known attractors</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing basin of known attractors...&quot;</span><span class="p">)</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="k">with</span> <span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;basin_known computation&quot;</span><span class="p">):</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">basin_known</span><span class="p">(</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>        <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>        <span class="n">attractors</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>            <span class="n">ReferenceRun</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Henon attractor&quot;</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>        <span class="p">],</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>        <span class="n">ic_grid</span><span class="o">=</span><span class="p">[</span><span class="n">grid_nx</span><span class="p">,</span> <span class="n">grid_ny</span><span class="p">],</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>        <span class="n">ic_bounds</span><span class="o">=</span><span class="p">[(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)],</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>        <span class="n">max_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>        <span class="n">transient_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>        <span class="n">signature_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>        <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>      <span class="c1"># 5% of attractor range</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>        <span class="n">min_match_ratio</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># 80% of points must match</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>        <span class="n">escape_bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)],</span>  <span class="c1"># Wide bounds for escape detection</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>        <span class="n">b_max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="c1"># Blowup threshold / None means literal NaN/Inf</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>        <span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>        <span class="n">refine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># refine is faster for high resolution grids</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>    <span class="p">)</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done!&quot;</span><span class="p">)</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="c1"># Analyze results</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="n">print_basin_summary</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="c1"># Visualization</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating visualization...&quot;</span><span class="p">)</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="n">theme</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="n">basin_plot</span><span class="p">(</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>    <span class="n">result</span><span class="p">,</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>    <span class="n">ylabel_rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>    <span class="n">ypad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Basin of Attraction - Henon Map (a=</span><span class="si">{</span><span class="n">a_param</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b_param</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>    <span class="n">titlepad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="p">)</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Visualization complete!&quot;</span><span class="p">)</span>
</code></pre></div>
Demonstrates <code>basin_known</code> + <code>ReferenceRun</code> to classify the Henon attractor during refinement. It feeds pre-computed attractor fingerprints into the known-attractor library, runs on a 512×512 grid, and shows how <code>signature_samples</code>, <code>tolerance</code>, and <code>min_match_ratio</code> influence the assignment.</p>
<h3 id="limit-cycle-basins">Limit-cycle basins</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">basin_auto</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">basin_plot</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">phase</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># Energy Template Oscillator (ETO) with Circular L Curve</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://ode/eto-circular&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;rk4&quot;</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1"># Globally stable limit cycle parameters</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">results</span> <span class="o">=</span> <span class="n">basin_auto</span><span class="p">(</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">ic_grid</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">ic_bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">dt_obs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="c1"># run long enough to converge + see the cycle</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">max_samples</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>          <span class="c1"># 40 time units</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="n">transient_samples</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>    <span class="c1"># 20 time units of transient</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="c1"># recurrence / evidence</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">window</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>                <span class="c1"># ~5.12 time units &gt; 1 period</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">recur_windows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="n">u_th</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>                  <span class="c1"># less strict; avoids missing clean periodic motion</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="n">post_detect_samples</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>  <span class="c1"># add extra evidence (aim: &gt;= 1–2 periods total)</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="c1"># merging</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    <span class="n">merge_downsample</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>        <span class="c1"># coarser fingerprint grid =&gt; more overlap</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="n">s_merge</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>               <span class="c1"># easier merge for same attractor under phase shifts</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="c1"># optional: make persistence assignment more stable</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="n">p_in</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    <span class="n">online_max_cells</span><span class="o">=</span><span class="mi">8192</span><span class="p">,</span>     <span class="c1"># avoid truncating the stored cell set for a large cycle</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="p">)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="c1"># Create an attractor</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transient</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="n">attr</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="c1"># Plotting</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">()</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="n">phase</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="n">basin_plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Globally stable limit cycle.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Edges can go outside for high mu values but they should converge back.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">basin_known</span><span class="p">,</span> <span class="n">ReferenceRun</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">basin_plot</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">phase</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1"># Energy Template Oscillator (ETO) with Circular L Curve</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://ode/eto-circular&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;rk4&quot;</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c1"># Globally stable limit cycle parameters</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">results</span> <span class="o">=</span> <span class="n">basin_known</span><span class="p">(</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="n">attractors</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        <span class="n">ReferenceRun</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Limit Cycle Attractor&quot;</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="p">],</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    <span class="n">ic_grid</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    <span class="n">ic_bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    <span class="n">dt_obs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    <span class="c1"># run long enough to converge + see the cycle</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="n">signature_samples</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="c1"># samples are in steps not time</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    <span class="n">max_samples</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    <span class="n">transient_samples</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>    <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>      <span class="c1"># 5% of attractor range</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>    <span class="n">min_match_ratio</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># 80% of points must match</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="n">escape_bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)],</span>  <span class="c1"># Wide bounds for escape detection</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>    <span class="n">b_max</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span> <span class="c1"># Blowup threshold / None means literal NaN/Inf</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="p">)</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="c1"># Create an attractor</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transient</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="n">attr</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="c1"># Plotting</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">()</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="n">phase</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="n">basin_plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
The first script uses <code>basin_auto</code> on the Energy Template Oscillator to capture a globally stable limit cycle via recurrence detection and post-detection persistence. The second repeats the experiment with <code>basin_known</code>/<code>ReferenceRun</code>, showcasing how to compare phase-space points with a reference trajectory while still refining the grid.</p>
<h3 id="refinement-benchmark">Refinement benchmark</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="sd">Benchmark for basin_known with refine=False and refine=True.</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="sd">Tests performance on different grid sizes: 64x64, 128x128, 256x256, 512x512.</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="sd">Uses the same parameters and model as basin_henon_known.py.</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">basin_known</span><span class="p">,</span> <span class="n">ReferenceRun</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1"># Setup Henon map model</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting up Henon map model...&quot;</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/henon&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="c1"># Set standard Henon parameters</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">a_param</span> <span class="o">=</span> <span class="mf">1.4</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="n">b_param</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a_param</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_param</span><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameters: a=</span><span class="si">{</span><span class="n">a_param</span><span class="si">}</span><span class="s2">, b=</span><span class="si">{</span><span class="n">b_param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  State variables: x, y&quot;</span><span class="p">)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="c1"># Domain for basin calculation (region near Henon attractor)</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="c1"># Common parameters for basin_known</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="n">attractors</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="n">ReferenceRun</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Henon attractor&quot;</span><span class="p">,</span> <span class="n">ic</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="p">]</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="n">ic_bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)]</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="n">max_samples</span> <span class="o">=</span> <span class="mi">500</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="n">transient_samples</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="n">signature_samples</span> <span class="o">=</span> <span class="mi">500</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.05</span>      <span class="c1"># 5% of attractor range</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="n">min_match_ratio</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># 80% of points must match</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="n">escape_bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)]</span>  <span class="c1"># Wide bounds for escape detection</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="n">b_max</span> <span class="o">=</span> <span class="mf">1e6</span>  <span class="c1"># Blowup threshold / None means literal NaN/Inf</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="n">parallel_mode</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="c1"># Grid sizes to test</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="n">grid_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Benchmarking basin_known with different grid sizes and refine options...&quot;</span><span class="p">)</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="n">grid_width</span> <span class="o">=</span> <span class="mi">12</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="n">time_width</span> <span class="o">=</span> <span class="mi">12</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="n">match_width</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Grid Size&#39;</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">grid_width</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;refine = False&#39;</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">time_width</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;refine = True&#39;</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">time_width</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;Match %&#39;</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">match_width</span><span class="si">}}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">+</span> <span class="n">time_width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">match_width</span> <span class="o">+</span> <span class="mi">9</span><span class="p">))</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="c1"># Warm-up</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="n">basin_known</span><span class="p">(</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>    <span class="n">attractors</span><span class="o">=</span><span class="n">attractors</span><span class="p">,</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>    <span class="n">ic_grid</span><span class="o">=</span><span class="p">[</span><span class="n">grid_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>    <span class="n">ic_bounds</span><span class="o">=</span><span class="n">ic_bounds</span><span class="p">,</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>    <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>    <span class="n">transient_samples</span><span class="o">=</span><span class="n">transient_samples</span><span class="p">,</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>    <span class="n">signature_samples</span><span class="o">=</span><span class="n">signature_samples</span><span class="p">,</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>    <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>    <span class="n">min_match_ratio</span><span class="o">=</span><span class="n">min_match_ratio</span><span class="p">,</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>    <span class="n">escape_bounds</span><span class="o">=</span><span class="n">escape_bounds</span><span class="p">,</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>    <span class="n">b_max</span><span class="o">=</span><span class="n">b_max</span><span class="p">,</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>    <span class="n">parallel_mode</span><span class="o">=</span><span class="n">parallel_mode</span><span class="p">,</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>    <span class="n">refine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="p">)</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">grid_sizes</span><span class="p">:</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>    <span class="n">ic_grid</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">]</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>    <span class="c1"># Measure refine=False</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>    <span class="n">result_false</span> <span class="o">=</span> <span class="n">basin_known</span><span class="p">(</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>        <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>        <span class="n">attractors</span><span class="o">=</span><span class="n">attractors</span><span class="p">,</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>        <span class="n">ic_grid</span><span class="o">=</span><span class="n">ic_grid</span><span class="p">,</span>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>        <span class="n">ic_bounds</span><span class="o">=</span><span class="n">ic_bounds</span><span class="p">,</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>        <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>        <span class="n">transient_samples</span><span class="o">=</span><span class="n">transient_samples</span><span class="p">,</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>        <span class="n">signature_samples</span><span class="o">=</span><span class="n">signature_samples</span><span class="p">,</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>        <span class="n">min_match_ratio</span><span class="o">=</span><span class="n">min_match_ratio</span><span class="p">,</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>        <span class="n">escape_bounds</span><span class="o">=</span><span class="n">escape_bounds</span><span class="p">,</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>        <span class="n">b_max</span><span class="o">=</span><span class="n">b_max</span><span class="p">,</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>        <span class="n">parallel_mode</span><span class="o">=</span><span class="n">parallel_mode</span><span class="p">,</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>        <span class="n">refine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>    <span class="p">)</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>    <span class="n">false_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>    <span class="c1"># Measure refine=True</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>    <span class="n">result_true</span> <span class="o">=</span> <span class="n">basin_known</span><span class="p">(</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>        <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>        <span class="n">attractors</span><span class="o">=</span><span class="n">attractors</span><span class="p">,</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>        <span class="n">ic_grid</span><span class="o">=</span><span class="n">ic_grid</span><span class="p">,</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>        <span class="n">ic_bounds</span><span class="o">=</span><span class="n">ic_bounds</span><span class="p">,</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>        <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>        <span class="n">transient_samples</span><span class="o">=</span><span class="n">transient_samples</span><span class="p">,</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>        <span class="n">signature_samples</span><span class="o">=</span><span class="n">signature_samples</span><span class="p">,</span>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a>        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>        <span class="n">min_match_ratio</span><span class="o">=</span><span class="n">min_match_ratio</span><span class="p">,</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>        <span class="n">escape_bounds</span><span class="o">=</span><span class="n">escape_bounds</span><span class="p">,</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>        <span class="n">b_max</span><span class="o">=</span><span class="n">b_max</span><span class="p">,</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>        <span class="n">parallel_mode</span><span class="o">=</span><span class="n">parallel_mode</span><span class="p">,</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>        <span class="n">refine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>    <span class="p">)</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>    <span class="n">true_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>    <span class="c1"># Compute match percentage</span>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a>    <span class="n">match_percentage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">result_false</span><span class="o">.</span><span class="n">labels</span> <span class="o">==</span> <span class="n">result_true</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">/</span> <span class="n">result_false</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s1">x</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s1">&#39;</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">grid_width</span><span class="si">}}</span><span class="s2"> | </span><span class="si">{</span><span class="n">false_time</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">time_width</span><span class="si">}</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">true_time</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">time_width</span><span class="si">}</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">match_percentage</span><span class="si">:</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">match_width</span><span class="si">}</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Benchmark complete!&quot;</span><span class="p">)</span>
</code></pre></div>
Bi-directional benchmark toggles <code>refine</code> on <code>basin_known</code> across grid sizes from 64×64 up to 1024×1024, printing wall-clock time and label agreement so you can see the performance payoff before enabling coarse-to-fine passes.</p>
<h2 id="lyapunov-exponents-and-spectral-sweeps">Lyapunov exponents and spectral sweeps</h2>
<h3 id="logistic-map-lyapunov-demo">Logistic-map Lyapunov demo</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="sd">Lyapunov exponent calculation for the logistic map.</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="sd">Demonstrates the runtime analysis system for computing maximum Lyapunov exponents (MLE)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="sd">and Lyapunov spectrum in discrete dynamical systems using the high-level Sim.run() API.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="sd">The Lyapunov exponent λ characterizes divergence of nearby trajectories:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="sd">    - λ &gt; 0: Chaotic behavior </span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="sd">    - λ = 0: Periodic orbits</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="sd">    - λ &lt; 0: Stable fixed points</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="sd">For the logistic map at r=4: λ = ln(2) ≈ 0.6931</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.runtime.observers</span><span class="w"> </span><span class="kn">import</span> <span class="n">lyapunov_mle_observer</span><span class="p">,</span> <span class="n">lyapunov_spectrum_observer</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">series</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="c1"># Single run with multiple observers</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/logistic&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="n">model</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="n">record_every</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="c1"># Run simulation using the high-level Sim API with multiple observers</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Lyapunov exponents with Sim.run()...&quot;</span><span class="p">)</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameter: r = 4.0&quot;</span><span class="p">)</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Iterations: 5000&quot;</span><span class="p">)</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Initial condition: x = 0.4&quot;</span><span class="p">)</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Observers: MLE and Spectrum&quot;</span><span class="p">)</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>    <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>    <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_every</span><span class="p">,</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>    <span class="n">observers</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>        <span class="n">lyapunov_mle_observer</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">record_interval</span><span class="o">=</span><span class="n">record_every</span><span class="p">),</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="n">lyapunov_spectrum_observer</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">record_interval</span><span class="o">=</span><span class="n">record_every</span><span class="p">),</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>    <span class="p">],</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="p">)</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="n">result</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="c1"># Extract runtime observer results</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESULTS&quot;</span><span class="p">)</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="c1"># Get observer result with ergonomic named access</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a><span class="n">lyap</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observers</span><span class="p">[</span><span class="s2">&quot;lyapunov_mle&quot;</span><span class="p">]</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="n">spectrum</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">observers</span><span class="p">[</span><span class="s2">&quot;lyapunov_spectrum&quot;</span><span class="p">]</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="c1"># Direct access to final MLE (auto-computed from trace)</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="n">mle</span> <span class="o">=</span> <span class="n">lyap</span><span class="o">.</span><span class="n">mle</span>  <span class="c1"># Final converged value from trace</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="n">log_growth</span> <span class="o">=</span> <span class="n">lyap</span><span class="o">.</span><span class="n">log_growth</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="n">n_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lyap</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="c1"># Get spectrum results (lyapunov_spectrum stores the final value in the trace)</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="n">spectrum_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">steps</span><span class="p">)</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="n">theoretical_mle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="n">x_trajectory</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="n">lyap_trace</span> <span class="o">=</span> <span class="n">lyap</span><span class="p">[</span><span class="s2">&quot;mle&quot;</span><span class="p">]</span>  <span class="c1"># Full trace array (use bracket for arrays)</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a><span class="n">spectrum_trace</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[</span><span class="s2">&quot;lyap0&quot;</span><span class="p">]</span>  <span class="c1"># Spectrum trace for first exponent</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a><span class="c1"># Note: trace may have one less point than trajectory if recording starts at t0</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a><span class="n">n_points</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_trajectory</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lyap_trace</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectrum_trace</span><span class="p">))</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a><span class="n">iterations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_points</span><span class="p">)</span>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a><span class="c1"># Get final spectrum value from trace (after data is loaded)</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a><span class="c1"># spectrum trace has alternating zeros, so find the last non-zero value</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a><span class="n">nonzero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">spectrum_trace</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a><span class="n">spectrum_mle</span> <span class="o">=</span> <span class="n">spectrum_trace</span><span class="p">[</span><span class="n">nonzero_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonzero_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Maximum Lyapunov Exponent (MLE):&quot;</span><span class="p">)</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Computed MLE:      </span><span class="si">{</span><span class="n">mle</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Theoretical MLE:   </span><span class="si">{</span><span class="n">theoretical_mle</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2"> (ln(2))&quot;</span><span class="p">)</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Relative error:    </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">mle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theoretical_mle</span><span class="p">)</span><span class="o">/</span><span class="n">theoretical_mle</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total iterations:  </span><span class="si">{</span><span class="n">n_steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lyapunov Spectrum:&quot;</span><span class="p">)</span>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Spectrum λ₀:       </span><span class="si">{</span><span class="n">spectrum_mle</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Theoretical λ₀:    </span><span class="si">{</span><span class="n">theoretical_mle</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}</span><span class="s2"> (ln(2))&quot;</span><span class="p">)</span>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Relative error:    </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">spectrum_mle</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theoretical_mle</span><span class="p">)</span><span class="o">/</span><span class="n">theoretical_mle</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total iterations:  </span><span class="si">{</span><span class="n">spectrum_steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a><span class="c1"># Visualize</span>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">)</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="n">theme</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a><span class="n">fig_obj</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a><span class="c1"># Plot trajectory (first 500 iterations)</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a><span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>    <span class="n">x</span><span class="o">=</span><span class="n">iterations</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a>    <span class="n">y</span><span class="o">=</span><span class="n">x_trajectory</span><span class="p">[:</span><span class="mi">500</span><span class="p">],</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a>    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">fig_obj</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Iteration (n)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$x_n$&quot;</span><span class="p">,</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Logistic Map Trajectory (r=4.0)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a><span class="p">)</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a><span class="c1"># Plot Lyapunov exponent convergence</span>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a><span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>    <span class="n">x</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a>    <span class="n">y</span><span class="o">=</span><span class="n">lyap_trace</span><span class="p">[:</span><span class="n">n_points</span><span class="p">],</span>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">fig_obj</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Iteration (n)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">lambda$ (MLE)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lyapunov Exponent Convergence&quot;</span><span class="p">,</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>    <span class="n">hlines</span><span class="o">=</span><span class="p">[(</span><span class="n">theoretical_mle</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Theoretical: λ = ln(2) ≈ </span><span class="si">{</span><span class="n">theoretical_mle</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)],</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>    <span class="n">hlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;label_pad&quot;</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">},</span>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a><span class="p">)</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a><span class="c1"># Annotate final value</span>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a><span class="n">fig_obj</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a>    <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>    <span class="sa">f</span><span class="s1">&#39;Computed: λ = </span><span class="si">{</span><span class="n">mle</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>    <span class="n">transform</span><span class="o">=</span><span class="n">fig_obj</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>    <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a><span class="p">)</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a><span class="c1"># Plot Lyapunov spectrum convergence</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a><span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>    <span class="n">x</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>    <span class="n">y</span><span class="o">=</span><span class="n">spectrum_trace</span><span class="p">[:</span><span class="n">n_points</span><span class="p">],</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">fig_obj</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Iteration (n)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">lambda$ (Spectrum)&quot;</span><span class="p">,</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lyapunov Spectrum Convergence&quot;</span><span class="p">,</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>    <span class="n">hlines</span><span class="o">=</span><span class="p">[(</span><span class="n">theoretical_mle</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Theoretical: λ = ln(2) ≈ </span><span class="si">{</span><span class="n">theoretical_mle</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)],</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>    <span class="n">hlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a><span class="p">)</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a><span class="c1"># Annotate final value from spectrum</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a><span class="n">spectrum_final</span> <span class="o">=</span> <span class="n">spectrum_trace</span><span class="p">[</span><span class="n">n_points</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">n_points</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a><span class="n">fig_obj</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>    <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>    <span class="sa">f</span><span class="s1">&#39;Computed: λ = </span><span class="si">{</span><span class="n">spectrum_final</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>    <span class="n">transform</span><span class="o">=</span><span class="n">fig_obj</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>    <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;wheat&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a><span class="p">)</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>
<a id="__codelineno-5-162" name="__codelineno-5-162" href="#__codelineno-5-162"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-5-163" name="__codelineno-5-163" href="#__codelineno-5-163"></a>
<a id="__codelineno-5-164" name="__codelineno-5-164" href="#__codelineno-5-164"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-165" name="__codelineno-5-165" href="#__codelineno-5-165"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter Scan&quot;</span><span class="p">)</span>
<a id="__codelineno-5-166" name="__codelineno-5-166" href="#__codelineno-5-166"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-167" name="__codelineno-5-167" href="#__codelineno-5-167"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;r&#39;</span><span class="si">:</span><span class="s2">&gt;6s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;λ (MLE)&#39;</span><span class="si">:</span><span class="s2">&gt;12s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Regime&#39;</span><span class="si">:</span><span class="s2">&gt;15s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-168" name="__codelineno-5-168" href="#__codelineno-5-168"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-169" name="__codelineno-5-169" href="#__codelineno-5-169"></a>
<a id="__codelineno-5-170" name="__codelineno-5-170" href="#__codelineno-5-170"></a><span class="n">test_r_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.83</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span>
<a id="__codelineno-5-171" name="__codelineno-5-171" href="#__codelineno-5-171"></a><span class="n">scan_sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/logistic&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-5-172" name="__codelineno-5-172" href="#__codelineno-5-172"></a>
<a id="__codelineno-5-173" name="__codelineno-5-173" href="#__codelineno-5-173"></a><span class="k">for</span> <span class="n">r_test</span> <span class="ow">in</span> <span class="n">test_r_values</span><span class="p">:</span>
<a id="__codelineno-5-174" name="__codelineno-5-174" href="#__codelineno-5-174"></a>    <span class="n">params_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_test</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<a id="__codelineno-5-175" name="__codelineno-5-175" href="#__codelineno-5-175"></a>    <span class="n">scan_sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-5-176" name="__codelineno-5-176" href="#__codelineno-5-176"></a>        <span class="n">N</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<a id="__codelineno-5-177" name="__codelineno-5-177" href="#__codelineno-5-177"></a>        <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-5-178" name="__codelineno-5-178" href="#__codelineno-5-178"></a>        <span class="n">record</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-179" name="__codelineno-5-179" href="#__codelineno-5-179"></a>        <span class="n">record_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-180" name="__codelineno-5-180" href="#__codelineno-5-180"></a>        <span class="n">max_steps</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<a id="__codelineno-5-181" name="__codelineno-5-181" href="#__codelineno-5-181"></a>        <span class="n">cap_rec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-182" name="__codelineno-5-182" href="#__codelineno-5-182"></a>        <span class="n">cap_evt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-183" name="__codelineno-5-183" href="#__codelineno-5-183"></a>        <span class="n">ic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
<a id="__codelineno-5-184" name="__codelineno-5-184" href="#__codelineno-5-184"></a>        <span class="n">params</span><span class="o">=</span><span class="n">params_test</span><span class="p">,</span>
<a id="__codelineno-5-185" name="__codelineno-5-185" href="#__codelineno-5-185"></a>        <span class="n">observers</span><span class="o">=</span><span class="n">lyapunov_mle_observer</span><span class="p">,</span>  <span class="c1"># Factory mode: Sim injects model</span>
<a id="__codelineno-5-186" name="__codelineno-5-186" href="#__codelineno-5-186"></a>    <span class="p">)</span>
<a id="__codelineno-5-187" name="__codelineno-5-187" href="#__codelineno-5-187"></a>
<a id="__codelineno-5-188" name="__codelineno-5-188" href="#__codelineno-5-188"></a>    <span class="n">lyap_result</span> <span class="o">=</span> <span class="n">scan_sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span><span class="o">.</span><span class="n">observers</span><span class="p">[</span><span class="s2">&quot;lyapunov_mle&quot;</span><span class="p">]</span>
<a id="__codelineno-5-189" name="__codelineno-5-189" href="#__codelineno-5-189"></a>    <span class="n">mle_test</span> <span class="o">=</span> <span class="n">lyap_result</span><span class="o">.</span><span class="n">mle</span>  <span class="c1"># Direct final value access</span>
<a id="__codelineno-5-190" name="__codelineno-5-190" href="#__codelineno-5-190"></a>
<a id="__codelineno-5-191" name="__codelineno-5-191" href="#__codelineno-5-191"></a>    <span class="k">if</span> <span class="n">mle_test</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
<a id="__codelineno-5-192" name="__codelineno-5-192" href="#__codelineno-5-192"></a>        <span class="n">regime</span> <span class="o">=</span> <span class="s2">&quot;Stable&quot;</span>
<a id="__codelineno-5-193" name="__codelineno-5-193" href="#__codelineno-5-193"></a>    <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mle_test</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
<a id="__codelineno-5-194" name="__codelineno-5-194" href="#__codelineno-5-194"></a>        <span class="n">regime</span> <span class="o">=</span> <span class="s2">&quot;Periodic&quot;</span>
<a id="__codelineno-5-195" name="__codelineno-5-195" href="#__codelineno-5-195"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-196" name="__codelineno-5-196" href="#__codelineno-5-196"></a>        <span class="n">regime</span> <span class="o">=</span> <span class="s2">&quot;Chaotic&quot;</span>
<a id="__codelineno-5-197" name="__codelineno-5-197" href="#__codelineno-5-197"></a>
<a id="__codelineno-5-198" name="__codelineno-5-198" href="#__codelineno-5-198"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r_test</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mle_test</span><span class="si">:</span><span class="s2">12.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">regime</span><span class="si">:</span><span class="s2">&gt;15s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-199" name="__codelineno-5-199" href="#__codelineno-5-199"></a>    <span class="n">scan_sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-5-200" name="__codelineno-5-200" href="#__codelineno-5-200"></a>
<a id="__codelineno-5-201" name="__codelineno-5-201" href="#__codelineno-5-201"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-5-202" name="__codelineno-5-202" href="#__codelineno-5-202"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The logistic map exhibits the period-doubling route to chaos.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-203" name="__codelineno-5-203" href="#__codelineno-5-203"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chaos emerges around r ≈ 3.57, fully developed at r = 4.&quot;</span><span class="p">)</span>
</code></pre></div>
Runs the logistic map at <code>r=4</code>, attaches both the MLE and spectrum runtime observers, and plots the trajectory, Lyapunov convergence, and final spectrum trace while printing the error against <code>ln(2)</code>. The script also prints a quick scan over several <code>r</code> values to classify stability vs. chaos.</p>
<h3 id="lorenz-system-lyapunov-demo">Lorenz-system Lyapunov demo</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="sd">Lyapunov exponent calculation for the Lorenz system.</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="sd">Demonstrates the runtime analysis system for computing maximum Lyapunov exponents (MLE)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="sd">and Lyapunov spectrum in continuous dynamical systems using the high-level Sim.run() API.</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.runtime.observers</span><span class="w"> </span><span class="kn">import</span> <span class="n">lyapunov_mle_observer</span><span class="p">,</span> <span class="n">lyapunov_spectrum_observer</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">fig</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">series</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># 1. Setup simulation</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># -------------------</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://ode/lorenz&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;rk4&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="c1"># Parameters for standard chaotic regime</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">sigma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="o">/</span><span class="mf">3.0</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="n">initial_state</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="c1"># Simulation control</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="n">total_time</span> <span class="o">=</span> <span class="mi">400</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="n">transient</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="n">record_interval</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running Lorenz simulation (T=</span><span class="si">{</span><span class="n">total_time</span><span class="si">}</span><span class="s2">, dt=</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">)...&quot;</span><span class="p">)</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="c1"># 2. Run MLE Analysis</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="c1"># -------------------</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing Maximum Lyapunov Exponent (MLE)...&quot;</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>    <span class="n">transient</span><span class="o">=</span><span class="n">transient</span><span class="p">,</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>    <span class="n">T</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">,</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>    <span class="n">observers</span><span class="o">=</span><span class="n">lyapunov_mle_observer</span><span class="p">(</span><span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">)</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="p">)</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="n">res_mle</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="n">mle_analysis</span> <span class="o">=</span> <span class="n">res_mle</span><span class="o">.</span><span class="n">observers</span><span class="p">[</span><span class="s2">&quot;lyapunov_mle&quot;</span><span class="p">]</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="c1"># 3. Run Spectrum Analysis</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="c1"># ------------------------</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing Lyapunov Spectrum (3 exponents)...&quot;</span><span class="p">)</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="n">sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>    <span class="n">transient</span><span class="o">=</span><span class="n">transient</span><span class="p">,</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>    <span class="n">T</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">,</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>    <span class="n">observers</span><span class="o">=</span><span class="n">lyapunov_spectrum_observer</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">)</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="p">)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="n">res_spec</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="n">spec_analysis</span> <span class="o">=</span> <span class="n">res_spec</span><span class="o">.</span><span class="n">observers</span><span class="p">[</span><span class="s2">&quot;lyapunov_spectrum&quot;</span><span class="p">]</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="c1"># 4. Results &amp; Validation</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="c1"># -----------------------</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RESULTS &amp; VALIDATION&quot;</span><span class="p">)</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="c1"># Theoretical values for Lorenz (standard parameters)</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="n">ref_lambda1</span> <span class="o">=</span> <span class="mf">0.9056</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="n">ref_lambda2</span> <span class="o">=</span> <span class="mf">0.0000</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="n">ref_lambda3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">14.5723</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="c1"># MLE Results</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="n">mle_calc</span> <span class="o">=</span> <span class="n">mle_analysis</span><span class="o">.</span><span class="n">mle</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="n">mle_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mle_calc</span> <span class="o">-</span> <span class="n">ref_lambda1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref_lambda1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Maximum Lyapunov Exponent (MLE):&quot;</span><span class="p">)</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Calculated:  </span><span class="si">{</span><span class="n">mle_calc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Theoretical: </span><span class="si">{</span><span class="n">ref_lambda1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Error:       </span><span class="si">{</span><span class="n">mle_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="c1"># Spectrum Results</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="c1"># Get final values from traces (using attribute access for final value)</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="n">l1_calc</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="o">.</span><span class="n">lyap0</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="n">l2_calc</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="o">.</span><span class="n">lyap1</span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a><span class="n">l3_calc</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="o">.</span><span class="n">lyap2</span>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a><span class="c1"># Calculate errors (handle division by zero for lambda2)</span>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="n">l1_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l1_calc</span> <span class="o">-</span> <span class="n">ref_lambda1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref_lambda1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="n">l3_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">l3_calc</span> <span class="o">-</span> <span class="n">ref_lambda3</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref_lambda3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Lyapunov Spectrum:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  λ₁: </span><span class="si">{</span><span class="n">l1_calc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Ref: </span><span class="si">{</span><span class="n">ref_lambda1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Err: </span><span class="si">{</span><span class="n">l1_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  λ₂: </span><span class="si">{</span><span class="n">l2_calc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Ref: </span><span class="si">{</span><span class="n">ref_lambda2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Err: N/A)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  λ₃: </span><span class="si">{</span><span class="n">l3_calc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Ref: </span><span class="si">{</span><span class="n">ref_lambda3</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Err: </span><span class="si">{</span><span class="n">l3_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sum: </span><span class="si">{</span><span class="n">l1_calc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l2_calc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l3_calc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Ref: </span><span class="si">{</span><span class="n">ref_lambda1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ref_lambda2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ref_lambda3</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a><span class="c1"># 5. Visualization</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a><span class="c1"># ----------------</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting results...&quot;</span><span class="p">)</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a><span class="c1"># Create a 3-row, 1-column grid</span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a><span class="n">grid</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lorenz System Lyapunov Analysis&quot;</span><span class="p">)</span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a><span class="n">ax_phase</span><span class="p">,</span> <span class="n">ax_mle</span><span class="p">,</span> <span class="n">ax_spec</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a><span class="c1"># Plot 1: Phase Portrait (x vs z)</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a><span class="c1"># Use the trajectory from the spectrum run (it has the same parameters)</span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a><span class="n">x</span> <span class="o">=</span> <span class="n">res_spec</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a><span class="n">z</span> <span class="o">=</span> <span class="n">res_spec</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a><span class="n">phase</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>    <span class="n">y</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax_phase</span><span class="p">,</span>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Phase Portrait (Lorenz Attractor)&quot;</span><span class="p">,</span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a><span class="p">)</span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a><span class="c1"># Plot 2: MLE Convergence</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a><span class="c1"># Use explicit trace_time from analysis result</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a><span class="n">t_mle</span> <span class="o">=</span> <span class="n">mle_analysis</span><span class="o">.</span><span class="n">trace_time</span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a><span class="n">mle_trace</span> <span class="o">=</span> <span class="n">mle_analysis</span><span class="p">[</span><span class="s2">&quot;mle&quot;</span><span class="p">]</span>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a><span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>    <span class="n">x</span><span class="o">=</span><span class="n">t_mle</span><span class="p">,</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>    <span class="n">y</span><span class="o">=</span><span class="n">mle_trace</span><span class="p">,</span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax_mle</span><span class="p">,</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MLE (λ₁) ≈ </span><span class="si">{</span><span class="n">mle_analysis</span><span class="o">.</span><span class="n">mle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Maximum Lyapunov Exponent Convergence&quot;</span><span class="p">,</span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;MLE&quot;</span><span class="p">,</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>    <span class="n">hlines</span><span class="o">=</span><span class="p">[(</span><span class="n">ref_lambda1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Theoretical λ₁ ≈ </span><span class="si">{</span><span class="n">ref_lambda1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)],</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>    <span class="n">hlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a><span class="p">)</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a><span class="n">ax_mle</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a><span class="c1"># Plot 3: Lyapunov Spectrum Convergence</span>
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a><span class="c1"># Use explicit trace_time from analysis result</span>
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a><span class="n">t_spec</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="o">.</span><span class="n">trace_time</span>
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a><span class="c1"># Spectrum trace columns: lyap0, lyap1, lyap2</span>
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a><span class="n">l1</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="p">[</span><span class="s2">&quot;lyap0&quot;</span><span class="p">]</span>
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a><span class="n">l2</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="p">[</span><span class="s2">&quot;lyap1&quot;</span><span class="p">]</span>
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a><span class="n">l3</span> <span class="o">=</span> <span class="n">spec_analysis</span><span class="p">[</span><span class="s2">&quot;lyap2&quot;</span><span class="p">]</span>
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a><span class="n">series</span><span class="o">.</span><span class="n">multi</span><span class="p">(</span>
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a>    <span class="n">x</span><span class="o">=</span><span class="n">t_spec</span><span class="p">,</span>
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a>    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">],</span>
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a>    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;λ₁ ≈ </span><span class="si">{</span><span class="n">l1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;λ₂ ≈ </span><span class="si">{</span><span class="n">l2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;λ₃ ≈ </span><span class="si">{</span><span class="n">l3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax_spec</span><span class="p">,</span>
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lyapunov Spectrum Convergence&quot;</span><span class="p">,</span>
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span>
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Exponents&quot;</span><span class="p">,</span>
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>    <span class="n">hlines</span><span class="o">=</span><span class="p">[</span><span class="n">ref_lambda1</span><span class="p">,</span> <span class="n">ref_lambda2</span><span class="p">,</span> <span class="n">ref_lambda3</span><span class="p">],</span>
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>    <span class="n">hlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a><span class="p">)</span>
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a><span class="n">ax_spec</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a><span class="c1"># Save figure</span>
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a><span class="c1"># export.savefig(grid, &quot;lyapunov_lorenz_demo.png&quot;)</span>
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
Repeats the approach for the continuous Lorenz attractor. It computes an <code>rk4</code> run with <code>lyapunov_mle_observer</code> and another with <code>lyapunov_spectrum_observer</code>, prints the error to the reference <code>(0.9056, 0.0, -14.57)</code> spectrum, and draws the attractor plus convergence traces.</p>
<h3 id="parameter-sweeps-with-lyapunov-statistics">Parameter sweeps with Lyapunov statistics</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="sd">Lyapunov exponent parameter sweep for the logistic map.</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="sd">Demonstrates sweep.lyapunov_mle_sweep for computing maximum Lyapunov exponents (MLE)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="sd">across a range of parameter values. This reveals the transition from order to chaos</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="sd">as a continuous function of the control parameter.</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="sd">For the logistic map x_{n+1} = r*x_n*(1-x_n):</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="sd">    - r &lt; 3.0: Stable fixed point (λ &lt; 0)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="sd">    - 3.0 &lt; r &lt; ~3.57: Periodic orbits (λ = 0)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="sd">    - r &gt; ~3.57: Chaotic regime (λ &gt; 0)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="sd">    - r = 4.0: Fully chaotic (λ = ln(2) ≈ 0.6931)</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">sweep</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">series</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">bifurcation_diagram</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="c1"># Setup simulation</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/logistic&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="c1"># Parameter sweep configuration (1000 points won&#39;t trigger parallelisation in auto mode)</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="n">r_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="n">record_every</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing bifurcation diagram and Lyapunov exponents for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">r_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> parameter values...&quot;</span><span class="p">)</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Parameter range: r ∈ [</span><span class="si">{</span><span class="n">r_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Iterations per run: 3000&quot;</span><span class="p">)</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Transient: 500&quot;</span><span class="p">)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trace recording interval: </span><span class="si">{</span><span class="n">record_every</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a><span class="c1"># First, compute bifurcation diagram</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing bifurcation diagram...&quot;</span><span class="p">)</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="n">sweep_bif</span> <span class="o">=</span> <span class="n">sweep</span><span class="o">.</span><span class="n">traj_sweep</span><span class="p">(</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>    <span class="n">values</span><span class="o">=</span><span class="n">r_values</span><span class="p">,</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>    <span class="n">record_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>    <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>    <span class="n">transient</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="p">)</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="n">result_bif</span> <span class="o">=</span> <span class="n">sweep_bif</span><span class="o">.</span><span class="n">bifurcation</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="c1"># Then, run parameter sweep with MLE analysis</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Lyapunov exponents...&quot;</span><span class="p">)</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>  <span class="c1"># Initial condition</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="n">res</span> <span class="o">=</span> <span class="n">sweep</span><span class="o">.</span><span class="n">lyapunov_mle_sweep</span><span class="p">(</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>    <span class="n">values</span><span class="o">=</span><span class="n">r_values</span><span class="p">,</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>    <span class="n">N</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>    <span class="n">transient</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>    <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_every</span><span class="p">,</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>    <span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>  <span class="c1"># Enable parallelization</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a><span class="p">)</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sweep completed!&quot;</span><span class="p">)</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sweep kind: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  MLE range: [</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Chaos onset (λ=0): r ≈ </span><span class="si">{</span><span class="n">r_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">))]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  MLE at r=4.0: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (theoretical: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a><span class="c1"># Optional: inspect recorded trace per-parameter (list of arrays)</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a><span class="n">trace_runs</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mle&quot;</span><span class="p">)</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a><span class="k">if</span> <span class="n">trace_runs</span><span class="p">:</span>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recorded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">trace_runs</span><span class="p">)</span><span class="si">}</span><span class="s2"> convergence traces (first length=</span><span class="si">{</span><span class="n">trace_runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a><span class="c1"># ===== Visualization =====</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">)</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a><span class="n">theme</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vline_label_placement_pad</span><span class="o">=</span><span class="mf">0.16</span><span class="p">)</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a><span class="c1"># Create figure with 2 rows: bifurcation diagram (top) and MLE (bottom)</span>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a><span class="c1"># Top panel: Bifurcation diagram</span>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a><span class="n">bifurcation_diagram</span><span class="p">(</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>    <span class="n">result_bif</span><span class="p">,</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;x*&quot;</span><span class="p">,</span>
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Bifurcation Diagram and Maximum Lyapunov Exponent&quot;</span><span class="p">,</span>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a>    <span class="n">title_fs</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a>    <span class="n">ylabel_fs</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>    <span class="n">vlines</span><span class="o">=</span><span class="p">[(</span><span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;r=3</span><span class="se">\n</span><span class="s1">(period-2)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.57</span><span class="p">,</span> <span class="s1">&#39;r≈3.57</span><span class="se">\n</span><span class="s1">(chaos)&#39;</span><span class="p">)],</span>
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>    <span class="n">vlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">,</span> 
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>                   <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> 
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>                   <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> 
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>                   <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a>                   <span class="s1">&#39;label_position&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,},</span>
<a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a><span class="p">)</span>
<a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a>
<a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a><span class="c1"># Bottom panel: MLE vs parameter (sharing same x-axis)</span>
<a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a><span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a>    <span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a>    <span class="n">y</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">,</span>
<a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a>    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">,</span>
<a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
<a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;λ (MLE)&quot;</span><span class="p">,</span>
<a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span>
<a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a>    <span class="n">xlabel_fs</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a>    <span class="n">ylabel_fs</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a>    <span class="n">vlines</span><span class="o">=</span><span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.57</span><span class="p">],</span>
<a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a>    <span class="n">vlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a><span class="p">)</span>
<a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a>
<a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a><span class="c1"># Add horizontal line at λ=0 (chaos boundary)</span>
<a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.6</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;λ = 0 (chaos boundary)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a>
<a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a><span class="c1"># Set x-limits to match</span>
<a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a>
<a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a>
<a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a><span class="c1"># ===== Analysis Summary =====</span>
<a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANALYSIS SUMMARY&quot;</span><span class="p">)</span>
<a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a>
<a id="__codelineno-7-129" name="__codelineno-7-129" href="#__codelineno-7-129"></a><span class="c1"># Find chaos onset (where λ crosses zero from negative to positive)</span>
<a id="__codelineno-7-130" name="__codelineno-7-130" href="#__codelineno-7-130"></a><span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-131" name="__codelineno-7-131" href="#__codelineno-7-131"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero_crossings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-7-132" name="__codelineno-7-132" href="#__codelineno-7-132"></a>    <span class="n">chaos_onset_idx</span> <span class="o">=</span> <span class="n">zero_crossings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-133" name="__codelineno-7-133" href="#__codelineno-7-133"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chaos onset (first λ=0 crossing): r ≈ </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">chaos_onset_idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-134" name="__codelineno-7-134" href="#__codelineno-7-134"></a>
<a id="__codelineno-7-135" name="__codelineno-7-135" href="#__codelineno-7-135"></a><span class="c1"># Count negative, zero, and positive MLE regions</span>
<a id="__codelineno-7-136" name="__codelineno-7-136" href="#__codelineno-7-136"></a><span class="n">n_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-7-137" name="__codelineno-7-137" href="#__codelineno-7-137"></a><span class="n">n_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-7-138" name="__codelineno-7-138" href="#__codelineno-7-138"></a><span class="n">n_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-7-139" name="__codelineno-7-139" href="#__codelineno-7-139"></a>
<a id="__codelineno-7-140" name="__codelineno-7-140" href="#__codelineno-7-140"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Region distribution:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-141" name="__codelineno-7-141" href="#__codelineno-7-141"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stable (λ &lt; 0):   </span><span class="si">{</span><span class="n">n_negative</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> points (</span><span class="si">{</span><span class="n">n_negative</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-142" name="__codelineno-7-142" href="#__codelineno-7-142"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Neutral (λ ≈ 0):  </span><span class="si">{</span><span class="n">n_zero</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> points (</span><span class="si">{</span><span class="n">n_zero</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-143" name="__codelineno-7-143" href="#__codelineno-7-143"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Chaotic (λ &gt; 0):  </span><span class="si">{</span><span class="n">n_positive</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> points (</span><span class="si">{</span><span class="n">n_positive</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-144" name="__codelineno-7-144" href="#__codelineno-7-144"></a>
<a id="__codelineno-7-145" name="__codelineno-7-145" href="#__codelineno-7-145"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Extreme values:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-146" name="__codelineno-7-146" href="#__codelineno-7-146"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Min MLE: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> at r=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-147" name="__codelineno-7-147" href="#__codelineno-7-147"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max MLE: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> at r=</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">mle</span><span class="p">)]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
uses <code>sweep.lyapunov_mle_sweep</code> for the logistic map, pairing the bifurcation extraction with an MLE sweep over 1000 <code>r</code> values so you can see chaos onset from λ crossing zero.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="sd">Lyapunov spectrum parameter sweep for the Lorenz system.</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="sd">Demonstrates sweep.lyapunov_spectrum_sweep for computing the full Lyapunov spectrum</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="sd">across a range of parameters, and overlays the results with a Lorenz</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="sd">bifurcation diagram.</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="sd">For the Lorenz system (sigma=10, beta=8/3):</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">    - rho &lt; ~24.74: stable fixed points</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="sd">    - rho &gt; ~24.74: chaotic regime</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">sweep</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">series</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">bifurcation_diagram</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="c1"># Setup simulation</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://ode/lorenz&quot;</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;rk4&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="n">sigma</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="o">/</span><span class="mf">3.0</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="n">initial_state</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="c1"># Sweep configuration</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="n">rho_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">)</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="n">total_time</span> <span class="o">=</span> <span class="mf">50.0</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="n">transient</span> <span class="o">=</span> <span class="mf">50.0</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="n">record_interval</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing Lorenz bifurcation + spectrum for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_values</span><span class="p">)</span><span class="si">}</span><span class="s2"> values...&quot;</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  rho range: [</span><span class="si">{</span><span class="n">rho_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rho_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  T=</span><span class="si">{</span><span class="n">total_time</span><span class="si">}</span><span class="s2">, dt=</span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">, transient=</span><span class="si">{</span><span class="n">transient</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="c1"># Bifurcation diagram (z vs rho)</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing bifurcation diagram...&quot;</span><span class="p">)</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="n">bif_sweep</span> <span class="o">=</span> <span class="n">sweep</span><span class="o">.</span><span class="n">traj_sweep</span><span class="p">(</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>    <span class="n">values</span><span class="o">=</span><span class="n">rho_values</span><span class="p">,</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>    <span class="n">record_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">],</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>    <span class="n">T</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>    <span class="n">transient</span><span class="o">=</span><span class="n">transient</span><span class="p">,</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">,</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="p">)</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="c1"># Local extrema give clean bifurcation diagrams for continuous systems</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="n">bif_result</span> <span class="o">=</span> <span class="n">bif_sweep</span><span class="o">.</span><span class="n">bifurcation</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">extrema</span><span class="p">(</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>    <span class="n">max_points</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Limit points in chaotic regime</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>    <span class="n">min_peak_distance</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="p">)</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="c1"># Lyapunov spectrum sweep</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Computing Lyapunov spectrum...&quot;</span><span class="p">)</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="n">sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="n">res</span> <span class="o">=</span> <span class="n">sweep</span><span class="o">.</span><span class="n">lyapunov_spectrum_sweep</span><span class="p">(</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>    <span class="n">values</span><span class="o">=</span><span class="n">rho_values</span><span class="p">,</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>    <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>    <span class="n">T</span><span class="o">=</span><span class="n">total_time</span><span class="p">,</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a>    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>    <span class="n">transient</span><span class="o">=</span><span class="n">transient</span><span class="p">,</span>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a>    <span class="n">record_interval</span><span class="o">=</span><span class="n">record_interval</span><span class="p">,</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>    <span class="n">parallel_mode</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a><span class="p">)</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sweep completed!&quot;</span><span class="p">)</span>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a><span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>    <span class="s2">&quot;  Spectrum min/max (lambda1): &quot;</span>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a>    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">lyap0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">lyap0</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a><span class="p">)</span>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a><span class="c1"># ===== Visualization =====</span>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">)</span>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a><span class="n">theme</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a>
<a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a>
<a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a><span class="c1"># Upper panel: Bifurcation diagram</span>
<a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a><span class="n">bifurcation_diagram</span><span class="p">(</span>
<a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a>    <span class="n">bif_result</span><span class="p">,</span>
<a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span>
<a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
<a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lorenz Bifurcation Diagram and Lyapunov Spectrum&quot;</span><span class="p">,</span>
<a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a>    <span class="n">title_fs</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
<a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a>    <span class="n">ylabel_fs</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a><span class="p">)</span>
<a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a>
<a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a><span class="c1"># Lower panel: Lyapunov spectrum vs parameter</span>
<a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a><span class="n">series</span><span class="o">.</span><span class="n">multi</span><span class="p">(</span>
<a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a>    <span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a>    <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">lyap0</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">lyap1</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">lyap2</span><span class="p">],</span>
<a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a>    <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">lambda_1$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">lambda_2$&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">lambda_3$&quot;</span><span class="p">],</span>
<a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span>
<a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Lyapunov exponents&quot;</span><span class="p">,</span>
<a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a>    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a>    <span class="n">hlines</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
<a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a>    <span class="n">hlines_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
<a id="__codelineno-8-109" name="__codelineno-8-109" href="#__codelineno-8-109"></a>    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">rho_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rho_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-8-110" name="__codelineno-8-110" href="#__codelineno-8-110"></a><span class="p">)</span>
<a id="__codelineno-8-111" name="__codelineno-8-111" href="#__codelineno-8-111"></a>
<a id="__codelineno-8-112" name="__codelineno-8-112" href="#__codelineno-8-112"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
sweeps the Lorenz <code>rho</code> parameter with <code>sweep.lyapunov_spectrum_sweep</code>, overlays the z-plane bifurcation, and plots all three Lyapunov exponents across the range.</p>
<h2 id="manifolds-and-orbit-finders">Manifolds and orbit finders</h2>
<h3 id="manifold-tracing">Manifold tracing</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_manifold_1d_map</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">manifold</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">fig</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.3</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="s2">&quot;builtin://map/henon2&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="n">sim</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="n">fp</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fixed_points</span><span class="p">(</span><span class="n">seeds</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]])</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="n">stable_results</span> <span class="o">=</span> <span class="n">trace_manifold_1d_map</span><span class="p">(</span> <span class="n">sim</span><span class="p">,</span> 
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>                                        <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>                                        <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>                                        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">,</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>                                        <span class="n">steps</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>                                        <span class="n">hmax</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>                                        <span class="n">clip_margin</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>                                        <span class="n">max_points_per_segment</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>                                        <span class="n">max_segments</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>                                    <span class="p">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="n">unstable_results</span> <span class="o">=</span> <span class="n">trace_manifold_1d_map</span><span class="p">(</span> <span class="n">sim</span><span class="p">,</span> 
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>                                          <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>                                          <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>                                          <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;unstable&quot;</span><span class="p">,</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>                                          <span class="n">steps</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>                                          <span class="n">hmax</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>                                          <span class="n">clip_margin</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>                                          <span class="n">max_points_per_segment</span><span class="o">=</span><span class="mi">120000</span><span class="p">,</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>                                          <span class="n">max_segments</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>                                        <span class="p">)</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="n">manifold</span><span class="p">(</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="n">result</span><span class="o">=</span><span class="n">stable_results</span><span class="p">,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">,</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>    <span class="n">xlim</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="n">ylim</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$y$&quot;</span><span class="p">,</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Henon map manifolds&quot;</span><span class="p">,</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>    <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="p">)</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="n">manifold</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">unstable_results</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;unstable&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fp</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;k+&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
traces the 1D stable and unstable manifolds of the Henon map fixed point using <code>trace_manifold_1d_map</code>, shows both branches on a single plot, and overlays the fixed point.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="sd">Example: Tracing stable and unstable manifolds of a 2D saddle point.</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="sd">Model: x&#39; = x, y&#39; = -y + x^2</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">Equilibrium at origin (0, 0) with:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="sd">  - Unstable eigenvalue λ=+1 (eigenvector along x-axis)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="sd">  - Stable eigenvalue λ=-1 (eigenvector along y-axis)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">Known analytic solutions:</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">  - Stable manifold: x = 0 (the y-axis)</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">  - Unstable manifold: y = x^2/3</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_manifold_1d_ode</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">manifold</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">fig</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="c1"># Define the saddle model inline</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="n">model_toml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="s2">inline:</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="s2">[model]</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="s2">type = &quot;ode&quot;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="s2">name = &quot;saddle2d&quot;</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="s2">[sim]</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="s2">t0 = 0.0</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="s2">T = 10.0</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="s2">dt = 0.01</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="s2">[states]</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="s2">x = 0.1</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="s2">y = 0.1</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="s2">[equations.rhs]</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="s2">x = &quot;x&quot;</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="s2">y = &quot;-y + x*x&quot;</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="c1"># Setup simulation</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">model_toml</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="c1"># Trace stable manifold (backward in time)</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="n">stable_result</span> <span class="o">=</span> <span class="n">trace_manifold_1d_ode</span><span class="p">(</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>    <span class="n">fp</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">,</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>    <span class="n">max_time</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>    <span class="n">resample_h</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="p">)</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="c1"># Trace unstable manifold (forward in time)</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a><span class="n">unstable_result</span> <span class="o">=</span> <span class="n">trace_manifold_1d_ode</span><span class="p">(</span>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>    <span class="n">fp</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a>    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;unstable&quot;</span><span class="p">,</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a>    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a>    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a>    <span class="n">max_time</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a>    <span class="n">resample_h</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="p">)</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="c1"># Validate against analytic solutions</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stable eigenvalue: </span><span class="si">{</span><span class="n">stable_result</span><span class="o">.</span><span class="n">eigenvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (expected: -1)&quot;</span><span class="p">)</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unstable eigenvalue: </span><span class="si">{</span><span class="n">unstable_result</span><span class="o">.</span><span class="n">eigenvalue</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (expected: +1)&quot;</span><span class="p">)</span>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="c1"># Check stable manifold (should be x=0)</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="n">stable_x_err</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a><span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">stable_result</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stable_result</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a>    <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a>        <span class="n">stable_x_err</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stable_x_err</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">branch</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stable manifold max |x| error: </span><span class="si">{</span><span class="n">stable_x_err</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a><span class="c1"># Check unstable manifold (should be y=x^2/3)</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a><span class="n">unstable_err</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a><span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">unstable_result</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">unstable_result</span><span class="o">.</span><span class="n">branches</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a>    <span class="k">if</span> <span class="n">branch</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a>        <span class="n">x_vals</span> <span class="o">=</span> <span class="n">branch</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a>        <span class="n">y_vals</span> <span class="o">=</span> <span class="n">branch</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a>        <span class="n">y_analytic</span> <span class="o">=</span> <span class="n">x_vals</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">3.0</span>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a>        <span class="n">unstable_err</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">unstable_err</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_vals</span> <span class="o">-</span> <span class="n">y_analytic</span><span class="p">)))</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unstable manifold max |y - x²/3| error: </span><span class="si">{</span><span class="n">unstable_err</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a><span class="c1"># Plot</span>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a><span class="c1"># Stable manifold (blue)</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a><span class="n">manifold</span><span class="p">(</span>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a>    <span class="n">result</span><span class="o">=</span><span class="n">stable_result</span><span class="p">,</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a>    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;W^s (stable)&quot;</span><span class="p">,</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a><span class="p">)</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a><span class="c1"># Unstable manifold (red)</span>
<a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a><span class="n">manifold</span><span class="p">(</span>
<a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a>    <span class="n">result</span><span class="o">=</span><span class="n">unstable_result</span><span class="p">,</span>
<a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a>    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
<a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a>    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;W^u (unstable)&quot;</span><span class="p">,</span>
<a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a>    <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-10-106" name="__codelineno-10-106" href="#__codelineno-10-106"></a><span class="p">)</span>
<a id="__codelineno-10-107" name="__codelineno-10-107" href="#__codelineno-10-107"></a>
<a id="__codelineno-10-108" name="__codelineno-10-108" href="#__codelineno-10-108"></a><span class="c1"># Analytic unstable manifold for comparison (dashed black)</span>
<a id="__codelineno-10-109" name="__codelineno-10-109" href="#__codelineno-10-109"></a><span class="n">x_analytic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-10-110" name="__codelineno-10-110" href="#__codelineno-10-110"></a><span class="n">y_analytic</span> <span class="o">=</span> <span class="n">x_analytic</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">3.0</span>
<a id="__codelineno-10-111" name="__codelineno-10-111" href="#__codelineno-10-111"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_analytic</span><span class="p">,</span> <span class="n">y_analytic</span><span class="p">,</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y = x²/3 (analytic)&quot;</span><span class="p">)</span>
<a id="__codelineno-10-112" name="__codelineno-10-112" href="#__codelineno-10-112"></a>
<a id="__codelineno-10-113" name="__codelineno-10-113" href="#__codelineno-10-113"></a><span class="c1"># Mark the equilibrium</span>
<a id="__codelineno-10-114" name="__codelineno-10-114" href="#__codelineno-10-114"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-10-115" name="__codelineno-10-115" href="#__codelineno-10-115"></a>
<a id="__codelineno-10-116" name="__codelineno-10-116" href="#__codelineno-10-116"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-10-117" name="__codelineno-10-117" href="#__codelineno-10-117"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-10-118" name="__codelineno-10-118" href="#__codelineno-10-118"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<a id="__codelineno-10-119" name="__codelineno-10-119" href="#__codelineno-10-119"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<a id="__codelineno-10-120" name="__codelineno-10-120" href="#__codelineno-10-120"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<a id="__codelineno-10-121" name="__codelineno-10-121" href="#__codelineno-10-121"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Stable/Unstable Manifolds: x&#39;=x, y&#39;=-y+x²&quot;</span><span class="p">)</span>
<a id="__codelineno-10-122" name="__codelineno-10-122" href="#__codelineno-10-122"></a><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<a id="__codelineno-10-123" name="__codelineno-10-123" href="#__codelineno-10-123"></a>
<a id="__codelineno-10-124" name="__codelineno-10-124" href="#__codelineno-10-124"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
builds a simple saddle ODE, traces the manifolds via <code>trace_manifold_1d_ode</code>, compares against analytic formulas (<code>x=0</code>, <code>y=x²/3</code>), and reports eigenvalue errors.</p>
<h3 id="homoclinic-heteroclinic-finders">Homoclinic &amp; heteroclinic finders</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="sd">Example: Homoclinic finder/tracer (manifold finder/tracer) on an inline model.</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="sd">Workflow:</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="sd">1) Use homoclinic_finder to locate a parameter value with a homoclinic orbit.</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="sd">2) Use homoclinic_tracer to trace and plot the orbit at the found parameter.</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="sd">This example demonstrates the simplified API with:</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="sd">- List inputs for equilibrium guess (no need for np.array)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="sd">- window parameter as list of tuples</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="sd">- preset parameter for common configurations (&quot;fast&quot;, &quot;default&quot;, &quot;precise&quot;)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="sd">Important: Matching Finder and Tracer Settings</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="sd">-----------------------------------------------</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="sd">The tracer should use the same section/radius settings as the finder:</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="sd">- r_sec (section radius) and t_min_event (minimum event time) should match</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="sd">  the finder&#39;s configuration to ensure consistent return-section logic.</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="sd">- If tracing fails with status &#39;no_cross&#39;, try increasing t_max or loosening</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="sd">  the finder&#39;s gap_tol/x_tol tolerances.</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="sd">Advanced Configuration</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="sd">----------------------</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="sd">For fine-grained control, you can use the full configuration classes:</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="sd">    from dynlib.analysis import (</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="sd">        HomoclinicRK45Config,      # RK45 integrator settings (dt0, atol, rtol, etc.)</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="sd">        HomoclinicBranchConfig,    # Branch tracing settings (eps, t_max, r_sec, etc.)</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="sd">        HomoclinicFinderConfig,    # Finder config</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="sd">    )</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="sd">    # Example: Custom RK45 and branch configuration</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="sd">    rk_cfg = HomoclinicRK45Config(dt0=1e-4, atol=1e-12, rtol=1e-9, max_steps=5_000_000)</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="sd">    branch_cfg = HomoclinicBranchConfig(</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="sd">        t_max=2000.0,</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="sd">        r_blow=200.0,</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="sd">        r_sec=1e-2,</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="sd">        window_min=[-3.0, -3.0],</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="sd">        window_max=[3.0, 3.0],</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="sd">        rk=rk_cfg,</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="sd">    )</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="sd">    finder_cfg = HomoclinicFinderConfig(</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="sd">        trace=branch_cfg,</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="sd">        scan_n=81,</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="sd">        max_bisect=60,</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="sd">        gap_tol=1e-6,</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="sd">        x_tol=1e-4,</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="sd">    )</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a><span class="sd">    result = homoclinic_finder(sim, ..., cfg=finder_cfg)</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="sd">You can also use `trace_cfg` for unified branch configuration:</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="sd">    result = homoclinic_finder(</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a><span class="sd">        sim, ...,</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a><span class="sd">        trace_cfg=branch_cfg,  # applies to the unstable branch</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a><span class="sd">        gap_tol=1e-6,</span>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a><span class="sd">    )</span>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>    <span class="n">homoclinic_finder</span><span class="p">,</span>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>    <span class="n">homoclinic_tracer</span><span class="p">,</span>
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a><span class="p">)</span>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">manifold</span>
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>
<a id="__codelineno-11-66" name="__codelineno-11-66" href="#__codelineno-11-66"></a>
<a id="__codelineno-11-67" name="__codelineno-11-67" href="#__codelineno-11-67"></a><span class="n">MODEL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-11-68" name="__codelineno-11-68" href="#__codelineno-11-68"></a><span class="s2">inline:</span>
<a id="__codelineno-11-69" name="__codelineno-11-69" href="#__codelineno-11-69"></a><span class="s2">[model]</span>
<a id="__codelineno-11-70" name="__codelineno-11-70" href="#__codelineno-11-70"></a><span class="s2">type = &quot;ode&quot;</span>
<a id="__codelineno-11-71" name="__codelineno-11-71" href="#__codelineno-11-71"></a><span class="s2">name = &quot;homoclinic-demo&quot;</span>
<a id="__codelineno-11-72" name="__codelineno-11-72" href="#__codelineno-11-72"></a>
<a id="__codelineno-11-73" name="__codelineno-11-73" href="#__codelineno-11-73"></a><span class="s2">[sim]</span>
<a id="__codelineno-11-74" name="__codelineno-11-74" href="#__codelineno-11-74"></a><span class="s2">t0 = 0.0</span>
<a id="__codelineno-11-75" name="__codelineno-11-75" href="#__codelineno-11-75"></a><span class="s2">T = 10.0</span>
<a id="__codelineno-11-76" name="__codelineno-11-76" href="#__codelineno-11-76"></a><span class="s2">dt = 0.01</span>
<a id="__codelineno-11-77" name="__codelineno-11-77" href="#__codelineno-11-77"></a>
<a id="__codelineno-11-78" name="__codelineno-11-78" href="#__codelineno-11-78"></a><span class="s2">[states]</span>
<a id="__codelineno-11-79" name="__codelineno-11-79" href="#__codelineno-11-79"></a><span class="s2">x = 0.0</span>
<a id="__codelineno-11-80" name="__codelineno-11-80" href="#__codelineno-11-80"></a><span class="s2">y = 0.0</span>
<a id="__codelineno-11-81" name="__codelineno-11-81" href="#__codelineno-11-81"></a>
<a id="__codelineno-11-82" name="__codelineno-11-82" href="#__codelineno-11-82"></a><span class="s2">[params]</span>
<a id="__codelineno-11-83" name="__codelineno-11-83" href="#__codelineno-11-83"></a><span class="s2">mu = -0.86</span>
<a id="__codelineno-11-84" name="__codelineno-11-84" href="#__codelineno-11-84"></a>
<a id="__codelineno-11-85" name="__codelineno-11-85" href="#__codelineno-11-85"></a><span class="s2">[equations.rhs]</span>
<a id="__codelineno-11-86" name="__codelineno-11-86" href="#__codelineno-11-86"></a><span class="s2">x = &quot;y&quot;</span>
<a id="__codelineno-11-87" name="__codelineno-11-87" href="#__codelineno-11-87"></a><span class="s2">y = &quot;mu*y + x - x*x + x*y&quot;</span>
<a id="__codelineno-11-88" name="__codelineno-11-88" href="#__codelineno-11-88"></a>
<a id="__codelineno-11-89" name="__codelineno-11-89" href="#__codelineno-11-89"></a><span class="s2">[equations.jacobian]</span>
<a id="__codelineno-11-90" name="__codelineno-11-90" href="#__codelineno-11-90"></a><span class="s2">expr = [</span>
<a id="__codelineno-11-91" name="__codelineno-11-91" href="#__codelineno-11-91"></a><span class="s2">    [&quot;0&quot;, &quot;1&quot;],</span>
<a id="__codelineno-11-92" name="__codelineno-11-92" href="#__codelineno-11-92"></a><span class="s2">    [&quot;1 - 2*x + y&quot;, &quot;mu + x&quot;]</span>
<a id="__codelineno-11-93" name="__codelineno-11-93" href="#__codelineno-11-93"></a><span class="s2">]</span>
<a id="__codelineno-11-94" name="__codelineno-11-94" href="#__codelineno-11-94"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-11-95" name="__codelineno-11-95" href="#__codelineno-11-95"></a>
<a id="__codelineno-11-96" name="__codelineno-11-96" href="#__codelineno-11-96"></a>
<a id="__codelineno-11-97" name="__codelineno-11-97" href="#__codelineno-11-97"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-11-98" name="__codelineno-11-98" href="#__codelineno-11-98"></a>
<a id="__codelineno-11-99" name="__codelineno-11-99" href="#__codelineno-11-99"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-11-100" name="__codelineno-11-100" href="#__codelineno-11-100"></a><span class="c1"># SIMPLIFIED API: Using preset and flattened kwargs</span>
<a id="__codelineno-11-101" name="__codelineno-11-101" href="#__codelineno-11-101"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-11-102" name="__codelineno-11-102" href="#__codelineno-11-102"></a>
<a id="__codelineno-11-103" name="__codelineno-11-103" href="#__codelineno-11-103"></a><span class="c1"># Simple case: just specify essential parameters, uses &quot;default&quot; preset</span>
<a id="__codelineno-11-104" name="__codelineno-11-104" href="#__codelineno-11-104"></a><span class="n">result</span> <span class="o">=</span> <span class="n">homoclinic_finder</span><span class="p">(</span>
<a id="__codelineno-11-105" name="__codelineno-11-105" href="#__codelineno-11-105"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-11-106" name="__codelineno-11-106" href="#__codelineno-11-106"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span>
<a id="__codelineno-11-107" name="__codelineno-11-107" href="#__codelineno-11-107"></a>    <span class="n">param_min</span><span class="o">=-</span><span class="mf">1.2</span><span class="p">,</span>
<a id="__codelineno-11-108" name="__codelineno-11-108" href="#__codelineno-11-108"></a>    <span class="n">param_max</span><span class="o">=-</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-11-109" name="__codelineno-11-109" href="#__codelineno-11-109"></a>    <span class="n">param_init</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-11-110" name="__codelineno-11-110" href="#__codelineno-11-110"></a>    <span class="n">eq_guess</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>  <span class="c1"># Lists work! No need for np.array</span>
<a id="__codelineno-11-111" name="__codelineno-11-111" href="#__codelineno-11-111"></a>    <span class="c1"># Simplified kwargs:</span>
<a id="__codelineno-11-112" name="__codelineno-11-112" href="#__codelineno-11-112"></a>    <span class="n">preset</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;fast&quot;, &quot;precise&quot;</span>
<a id="__codelineno-11-113" name="__codelineno-11-113" href="#__codelineno-11-113"></a>    <span class="n">window</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>  <span class="c1"># state-space bounds as (min, max) tuples</span>
<a id="__codelineno-11-114" name="__codelineno-11-114" href="#__codelineno-11-114"></a>    <span class="n">scan_n</span><span class="o">=</span><span class="mi">61</span><span class="p">,</span>
<a id="__codelineno-11-115" name="__codelineno-11-115" href="#__codelineno-11-115"></a>    <span class="n">max_bisect</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<a id="__codelineno-11-116" name="__codelineno-11-116" href="#__codelineno-11-116"></a>    <span class="n">gap_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<a id="__codelineno-11-117" name="__codelineno-11-117" href="#__codelineno-11-117"></a>    <span class="n">x_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<a id="__codelineno-11-118" name="__codelineno-11-118" href="#__codelineno-11-118"></a>    <span class="n">t_max</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span>
<a id="__codelineno-11-119" name="__codelineno-11-119" href="#__codelineno-11-119"></a>    <span class="n">r_blow</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-11-120" name="__codelineno-11-120" href="#__codelineno-11-120"></a><span class="p">)</span>
<a id="__codelineno-11-121" name="__codelineno-11-121" href="#__codelineno-11-121"></a>
<a id="__codelineno-11-122" name="__codelineno-11-122" href="#__codelineno-11-122"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-11-123" name="__codelineno-11-123" href="#__codelineno-11-123"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mu_found:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="p">)</span>
<a id="__codelineno-11-124" name="__codelineno-11-124" href="#__codelineno-11-124"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fail:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">])</span>
<a id="__codelineno-11-125" name="__codelineno-11-125" href="#__codelineno-11-125"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best_by_abs_gap:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;best_by_abs_gap&quot;</span><span class="p">])</span>
<a id="__codelineno-11-126" name="__codelineno-11-126" href="#__codelineno-11-126"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best_by_q:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;best_by_q&quot;</span><span class="p">])</span>
<a id="__codelineno-11-127" name="__codelineno-11-127" href="#__codelineno-11-127"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-128" name="__codelineno-11-128" href="#__codelineno-11-128"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-11-129" name="__codelineno-11-129" href="#__codelineno-11-129"></a>        <span class="s2">&quot;gap_found:&quot;</span><span class="p">,</span>
<a id="__codelineno-11-130" name="__codelineno-11-130" href="#__codelineno-11-130"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;gap_found&quot;</span><span class="p">],</span>
<a id="__codelineno-11-131" name="__codelineno-11-131" href="#__codelineno-11-131"></a>        <span class="s2">&quot;q_found:&quot;</span><span class="p">,</span>
<a id="__codelineno-11-132" name="__codelineno-11-132" href="#__codelineno-11-132"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;q_found&quot;</span><span class="p">],</span>
<a id="__codelineno-11-133" name="__codelineno-11-133" href="#__codelineno-11-133"></a>        <span class="s2">&quot;t_cross:&quot;</span><span class="p">,</span>
<a id="__codelineno-11-134" name="__codelineno-11-134" href="#__codelineno-11-134"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;t_cross&quot;</span><span class="p">],</span>
<a id="__codelineno-11-135" name="__codelineno-11-135" href="#__codelineno-11-135"></a>    <span class="p">)</span>
<a id="__codelineno-11-136" name="__codelineno-11-136" href="#__codelineno-11-136"></a>
<a id="__codelineno-11-137" name="__codelineno-11-137" href="#__codelineno-11-137"></a><span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-138" name="__codelineno-11-138" href="#__codelineno-11-138"></a>    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">&quot;Homoclinic finder did not converge; see info above.&quot;</span><span class="p">)</span>
<a id="__codelineno-11-139" name="__codelineno-11-139" href="#__codelineno-11-139"></a>
<a id="__codelineno-11-140" name="__codelineno-11-140" href="#__codelineno-11-140"></a><span class="c1"># Trace the orbit using the simplified API</span>
<a id="__codelineno-11-141" name="__codelineno-11-141" href="#__codelineno-11-141"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">homoclinic_tracer</span><span class="p">(</span>
<a id="__codelineno-11-142" name="__codelineno-11-142" href="#__codelineno-11-142"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-11-143" name="__codelineno-11-143" href="#__codelineno-11-143"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span>
<a id="__codelineno-11-144" name="__codelineno-11-144" href="#__codelineno-11-144"></a>    <span class="n">param_value</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="p">,</span>
<a id="__codelineno-11-145" name="__codelineno-11-145" href="#__codelineno-11-145"></a>    <span class="n">eq</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>          <span class="c1"># Can also use lists: [0.0, 0.0]</span>
<a id="__codelineno-11-146" name="__codelineno-11-146" href="#__codelineno-11-146"></a>    <span class="n">sign_u</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">sign_u</span><span class="p">,</span>
<a id="__codelineno-11-147" name="__codelineno-11-147" href="#__codelineno-11-147"></a>    <span class="n">preset</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>  <span class="c1"># Use same preset as finder for consistency</span>
<a id="__codelineno-11-148" name="__codelineno-11-148" href="#__codelineno-11-148"></a>    <span class="n">window</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-11-149" name="__codelineno-11-149" href="#__codelineno-11-149"></a>    <span class="n">t_max</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span>
<a id="__codelineno-11-150" name="__codelineno-11-150" href="#__codelineno-11-150"></a>    <span class="n">r_blow</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-11-151" name="__codelineno-11-151" href="#__codelineno-11-151"></a>    <span class="n">r_sec</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">r_sec</span><span class="p">,</span>
<a id="__codelineno-11-152" name="__codelineno-11-152" href="#__codelineno-11-152"></a>    <span class="n">t_min_event</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">t_min</span><span class="p">,</span>
<a id="__codelineno-11-153" name="__codelineno-11-153" href="#__codelineno-11-153"></a><span class="p">)</span>
<a id="__codelineno-11-154" name="__codelineno-11-154" href="#__codelineno-11-154"></a>
<a id="__codelineno-11-155" name="__codelineno-11-155" href="#__codelineno-11-155"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trace success: &quot;</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-11-156" name="__codelineno-11-156" href="#__codelineno-11-156"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;status: &quot;</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<a id="__codelineno-11-157" name="__codelineno-11-157" href="#__codelineno-11-157"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event: &quot;</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
<a id="__codelineno-11-158" name="__codelineno-11-158" href="#__codelineno-11-158"></a>
<a id="__codelineno-11-159" name="__codelineno-11-159" href="#__codelineno-11-159"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-11-160" name="__codelineno-11-160" href="#__codelineno-11-160"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tracing failed with status &#39;</span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-11-161" name="__codelineno-11-161" href="#__codelineno-11-161"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider increasing t_max or loosening gap_tol/x_tol.&quot;</span><span class="p">)</span>
<a id="__codelineno-11-162" name="__codelineno-11-162" href="#__codelineno-11-162"></a>
<a id="__codelineno-11-163" name="__codelineno-11-163" href="#__codelineno-11-163"></a><span class="c1"># Only plot if we have valid trajectory data</span>
<a id="__codelineno-11-164" name="__codelineno-11-164" href="#__codelineno-11-164"></a><span class="n">traj</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-11-165" name="__codelineno-11-165" href="#__codelineno-11-165"></a><span class="k">if</span> <span class="n">traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-11-166" name="__codelineno-11-166" href="#__codelineno-11-166"></a>    <span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<a id="__codelineno-11-167" name="__codelineno-11-167" href="#__codelineno-11-167"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">()</span>
<a id="__codelineno-11-168" name="__codelineno-11-168" href="#__codelineno-11-168"></a>
<a id="__codelineno-11-169" name="__codelineno-11-169" href="#__codelineno-11-169"></a>    <span class="n">title_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="s2">&quot; (partial, no return-section hit)&quot;</span>
<a id="__codelineno-11-170" name="__codelineno-11-170" href="#__codelineno-11-170"></a>
<a id="__codelineno-11-171" name="__codelineno-11-171" href="#__codelineno-11-171"></a>    <span class="n">manifold</span><span class="p">(</span>
<a id="__codelineno-11-172" name="__codelineno-11-172" href="#__codelineno-11-172"></a>        <span class="n">result</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span>
<a id="__codelineno-11-173" name="__codelineno-11-173" href="#__codelineno-11-173"></a>        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-11-174" name="__codelineno-11-174" href="#__codelineno-11-174"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<a id="__codelineno-11-175" name="__codelineno-11-175" href="#__codelineno-11-175"></a>        <span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
<a id="__codelineno-11-176" name="__codelineno-11-176" href="#__codelineno-11-176"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Homoclinic excursion&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; (closed)&quot;</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="s2">&quot; (incomplete)&quot;</span><span class="p">),</span>
<a id="__codelineno-11-177" name="__codelineno-11-177" href="#__codelineno-11-177"></a>        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">),</span>
<a id="__codelineno-11-178" name="__codelineno-11-178" href="#__codelineno-11-178"></a>        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<a id="__codelineno-11-179" name="__codelineno-11-179" href="#__codelineno-11-179"></a>        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-11-180" name="__codelineno-11-180" href="#__codelineno-11-180"></a>        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
<a id="__codelineno-11-181" name="__codelineno-11-181" href="#__codelineno-11-181"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Homoclinic orbit at mu=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}{</span><span class="n">title_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-11-182" name="__codelineno-11-182" href="#__codelineno-11-182"></a>        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span>
<a id="__codelineno-11-183" name="__codelineno-11-183" href="#__codelineno-11-183"></a>    <span class="p">)</span>
<a id="__codelineno-11-184" name="__codelineno-11-184" href="#__codelineno-11-184"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Equilibrium&quot;</span><span class="p">)</span>
<a id="__codelineno-11-185" name="__codelineno-11-185" href="#__codelineno-11-185"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">x_cross</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">x_cross</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Section cross&quot;</span><span class="p">)</span>
<a id="__codelineno-11-186" name="__codelineno-11-186" href="#__codelineno-11-186"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<a id="__codelineno-11-187" name="__codelineno-11-187" href="#__codelineno-11-187"></a>
<a id="__codelineno-11-188" name="__codelineno-11-188" href="#__codelineno-11-188"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-189" name="__codelineno-11-189" href="#__codelineno-11-189"></a><span class="sd">    Section cross: This is the point where the unstable manifold trajectory</span>
<a id="__codelineno-11-190" name="__codelineno-11-190" href="#__codelineno-11-190"></a><span class="sd">    re-enters the return section defined by r_sec around the equilibrium.</span>
<a id="__codelineno-11-191" name="__codelineno-11-191" href="#__codelineno-11-191"></a><span class="sd">    When a homoclinic orbit exists, the crossing should align with the unstable</span>
<a id="__codelineno-11-192" name="__codelineno-11-192" href="#__codelineno-11-192"></a><span class="sd">    direction, making the signed return value g close to zero.</span>
<a id="__codelineno-11-193" name="__codelineno-11-193" href="#__codelineno-11-193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-194" name="__codelineno-11-194" href="#__codelineno-11-194"></a>
<a id="__codelineno-11-195" name="__codelineno-11-195" href="#__codelineno-11-195"></a>    <span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-11-196" name="__codelineno-11-196" href="#__codelineno-11-196"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-197" name="__codelineno-11-197" href="#__codelineno-11-197"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No trajectory data to plot.&quot;</span><span class="p">)</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="sd">Example: Heteroclinic finder/tracer (manifold finder/tracer) on an inline model.</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">Workflow:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">1) Use heteroclinic_finder to locate a parameter value with a heteroclinic orbit.</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">2) Use heteroclinic_tracer to trace and plot the orbit at the found parameter.</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">This example demonstrates the simplified API with:</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">- List inputs for fixed points (no need for np.array)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="sd">- window parameter as list of tuples</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="sd">- preset parameter for common configurations (&quot;fast&quot;, &quot;default&quot;, &quot;precise&quot;)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="sd">Important: Matching Finder and Tracer Settings</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="sd">-----------------------------------------------</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="sd">The tracer&#39;s hit_radius should be chosen carefully based on the finder&#39;s accuracy:</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="sd">- If finder reports gap_found ~ 1e-4, use hit_radius ~ 0.01 to 0.05</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="sd">- If finder reports gap_found ~ 1e-6, use hit_radius ~ 0.001 to 0.01</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="sd">- Rule of thumb: hit_radius ≈ 5-50x the finder&#39;s gap_found value</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="sd">- Use the same preset for both finder and tracer for consistency</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="sd">The finder and tracer may have slightly different numerical behavior, so the</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="sd">tracer might not achieve the exact same precision as the finder&#39;s gap measurement.</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="sd">If the tracer fails with status &#39;window&#39; or gets close but doesn&#39;t hit the target,</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="sd">either increase hit_radius or tighten the finder&#39;s gap_tol/x_tol tolerances.</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="sd">Advanced Configuration</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="sd">----------------------</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="sd">For fine-grained control, you can use the full configuration classes:</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="sd">    from dynlib.analysis import (</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="sd">        HeteroclinicRK45Config,      # RK45 integrator settings (dt0, atol, rtol, etc.)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="sd">        HeteroclinicBranchConfig,    # Branch tracing settings (eps, t_max, window, etc.)</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="sd">        HeteroclinicFinderConfig2D,  # Finder config for 2D systems</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="sd">        HeteroclinicFinderConfigND,  # Finder config for N-dimensional systems</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="sd">    )</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="sd">    # Example: Custom RK45 and branch configuration</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="sd">    rk_cfg = HeteroclinicRK45Config(dt0=1e-4, atol=1e-12, rtol=1e-9, max_steps=5_000_000)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="sd">    branch_cfg = HeteroclinicBranchConfig(</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="sd">        t_max=500.0,</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="sd">        r_blow=500.0,</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="sd">        window_min=[-20.0, -20.0],</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="sd">        window_max=[20.0, 20.0],</span>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="sd">        rk=rk_cfg,</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a><span class="sd">    )</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="sd">    finder_cfg = HeteroclinicFinderConfigND(</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a><span class="sd">        trace_u=branch_cfg,</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="sd">        trace_s=branch_cfg,</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a><span class="sd">        scan_n=121,</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="sd">        max_bisect=80,</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="sd">        gap_tol=1e-6,</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a><span class="sd">    )</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a><span class="sd">    result = heteroclinic_finder(sim, ..., cfg=finder_cfg)</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a><span class="sd">You can also use `trace_cfg` for unified branch configuration:</span>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="sd">    result = heteroclinic_finder(</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a><span class="sd">        sim, ...,</span>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a><span class="sd">        trace_cfg=branch_cfg,  # applies to both unstable and stable branches</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="sd">        gap_tol=1e-6,</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a><span class="sd">    )</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>    <span class="n">heteroclinic_finder</span><span class="p">,</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>    <span class="n">heteroclinic_tracer</span><span class="p">,</span>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a><span class="p">)</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">export</span><span class="p">,</span> <span class="n">manifold</span>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="n">MODEL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a><span class="s2">inline:</span>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="s2">[model]</span>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="s2">type = &quot;ode&quot;</span>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a><span class="s2">name = &quot;heteroclinic-demo&quot;</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>
<a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a><span class="s2">[sim]</span>
<a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a><span class="s2">t0 = 0.0</span>
<a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a><span class="s2">T = 10.0</span>
<a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a><span class="s2">dt = 0.01</span>
<a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>
<a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a><span class="s2">[states]</span>
<a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a><span class="s2">u = 0.0</span>
<a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a><span class="s2">v = 0.0</span>
<a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>
<a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a><span class="s2">[params]</span>
<a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a><span class="s2">c = 0.0</span>
<a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a><span class="s2">a = 0.3</span>
<a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>
<a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a><span class="s2">[equations.rhs]</span>
<a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a><span class="s2">u = &quot;v&quot;</span>
<a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a><span class="s2">v = &quot;-c*v - u*(1-u)*(u-a)&quot;</span>
<a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>
<a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a><span class="s2">[equations.jacobian]</span>
<a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a><span class="s2">expr = [</span>
<a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a><span class="s2">    [&quot;0&quot;, &quot;1&quot;],</span>
<a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a><span class="s2">    [&quot;3*u*u - 2*(1+a)*u + a&quot;, &quot;-c&quot;]</span>
<a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a><span class="s2">]</span>
<a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>
<a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>
<a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>
<a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a><span class="c1"># NOTE: Stricter hit_radius requires stricter config values!</span>
<a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a><span class="c1">#       With 0.02 you will see a gap near fixed points.</span>
<a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a><span class="n">hit_radius</span> <span class="o">=</span> <span class="mf">0.02</span>
<a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a>
<a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a><span class="c1"># SIMPLIFIED API: Using preset and flattened kwargs</span>
<a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a>
<a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a><span class="c1"># Simple case: just specify essential parameters, uses &quot;default&quot; preset</span>
<a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a><span class="n">result</span> <span class="o">=</span> <span class="n">heteroclinic_finder</span><span class="p">(</span>
<a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
<a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>    <span class="n">param_min</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>    <span class="n">param_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>    <span class="n">param_init</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>    <span class="n">source_eq_guess</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>  <span class="c1"># Lists work! No need for np.array</span>
<a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>    <span class="n">target_eq_guess</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
<a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>    <span class="c1"># Simplified kwargs:</span>
<a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>    <span class="n">preset</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;fast&quot;, &quot;precise&quot;</span>
<a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>    <span class="n">window</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span>  <span class="c1"># state-space bounds as (min, max) tuples</span>
<a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>    <span class="n">scan_n</span><span class="o">=</span><span class="mi">61</span><span class="p">,</span>
<a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>    <span class="n">max_bisect</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>    <span class="n">gap_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>    <span class="n">x_tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a>    <span class="n">t_max</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>    <span class="n">r_blow</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a><span class="p">)</span>
<a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>
<a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;success:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c_found:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="p">)</span>
<a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fail:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;fail&quot;</span><span class="p">])</span>
<a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sign_u, sign_s:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;sign_u&quot;</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;sign_s&quot;</span><span class="p">])</span>
<a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best_by_abs_gap:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;best_by_abs_gap&quot;</span><span class="p">])</span>
<a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;best_by_q:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;best_by_q&quot;</span><span class="p">])</span>
<a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a><span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a>        <span class="s2">&quot;gap_found:&quot;</span><span class="p">,</span>
<a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;gap_found&quot;</span><span class="p">],</span>
<a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>        <span class="s2">&quot;gap_tol_eff_found:&quot;</span><span class="p">,</span>
<a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;gap_tol_eff_found&quot;</span><span class="p">],</span>
<a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>        <span class="s2">&quot;q_found:&quot;</span><span class="p">,</span>
<a id="__codelineno-12-148" name="__codelineno-12-148" href="#__codelineno-12-148"></a>        <span class="n">result</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;q_found&quot;</span><span class="p">],</span>
<a id="__codelineno-12-149" name="__codelineno-12-149" href="#__codelineno-12-149"></a>    <span class="p">)</span>
<a id="__codelineno-12-150" name="__codelineno-12-150" href="#__codelineno-12-150"></a>
<a id="__codelineno-12-151" name="__codelineno-12-151" href="#__codelineno-12-151"></a><span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-152" name="__codelineno-12-152" href="#__codelineno-12-152"></a>    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s2">&quot;Heteroclinic finder did not converge; see info above.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-153" name="__codelineno-12-153" href="#__codelineno-12-153"></a>
<a id="__codelineno-12-154" name="__codelineno-12-154" href="#__codelineno-12-154"></a><span class="c1"># Trace the orbit using the simplified API</span>
<a id="__codelineno-12-155" name="__codelineno-12-155" href="#__codelineno-12-155"></a><span class="c1"># Note: hit_radius should be adjusted based on the accuracy of the finder&#39;s gap (gap_found).</span>
<a id="__codelineno-12-156" name="__codelineno-12-156" href="#__codelineno-12-156"></a><span class="c1"># If the finder&#39;s gap is ~1e-4, a hit_radius of 1e-3 may be too strict for the tracer.</span>
<a id="__codelineno-12-157" name="__codelineno-12-157" href="#__codelineno-12-157"></a><span class="c1"># Reasonable values: 0.01 to 0.05 for typical cases, or 5-10x the finder&#39;s gap_found.</span>
<a id="__codelineno-12-158" name="__codelineno-12-158" href="#__codelineno-12-158"></a><span class="n">trace</span> <span class="o">=</span> <span class="n">heteroclinic_tracer</span><span class="p">(</span>
<a id="__codelineno-12-159" name="__codelineno-12-159" href="#__codelineno-12-159"></a>    <span class="n">sim</span><span class="p">,</span>
<a id="__codelineno-12-160" name="__codelineno-12-160" href="#__codelineno-12-160"></a>    <span class="n">param</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
<a id="__codelineno-12-161" name="__codelineno-12-161" href="#__codelineno-12-161"></a>    <span class="n">param_value</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="p">,</span>
<a id="__codelineno-12-162" name="__codelineno-12-162" href="#__codelineno-12-162"></a>    <span class="n">source_eq</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">source_eq</span><span class="p">,</span>  <span class="c1"># Can also use lists: [0.0, 0.0]</span>
<a id="__codelineno-12-163" name="__codelineno-12-163" href="#__codelineno-12-163"></a>    <span class="n">target_eq</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">target_eq</span><span class="p">,</span>
<a id="__codelineno-12-164" name="__codelineno-12-164" href="#__codelineno-12-164"></a>    <span class="n">sign_u</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">sign_u</span><span class="p">,</span>
<a id="__codelineno-12-165" name="__codelineno-12-165" href="#__codelineno-12-165"></a>    <span class="n">preset</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>  <span class="c1"># Use same preset as finder for consistency</span>
<a id="__codelineno-12-166" name="__codelineno-12-166" href="#__codelineno-12-166"></a>    <span class="n">window</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span>
<a id="__codelineno-12-167" name="__codelineno-12-167" href="#__codelineno-12-167"></a>    <span class="n">t_max</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-12-168" name="__codelineno-12-168" href="#__codelineno-12-168"></a>    <span class="n">hit_radius</span><span class="o">=</span><span class="n">hit_radius</span><span class="p">,</span>  <span class="c1"># Adjusted to be more realistic given gap_found ~ 2e-4</span>
<a id="__codelineno-12-169" name="__codelineno-12-169" href="#__codelineno-12-169"></a><span class="p">)</span>
<a id="__codelineno-12-170" name="__codelineno-12-170" href="#__codelineno-12-170"></a>
<a id="__codelineno-12-171" name="__codelineno-12-171" href="#__codelineno-12-171"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trace success: &quot;</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span><span class="p">)</span>
<a id="__codelineno-12-172" name="__codelineno-12-172" href="#__codelineno-12-172"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;status: &quot;</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<a id="__codelineno-12-173" name="__codelineno-12-173" href="#__codelineno-12-173"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;event: &quot;</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">event</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
<a id="__codelineno-12-174" name="__codelineno-12-174" href="#__codelineno-12-174"></a>
<a id="__codelineno-12-175" name="__codelineno-12-175" href="#__codelineno-12-175"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-12-176" name="__codelineno-12-176" href="#__codelineno-12-176"></a>    <span class="c1"># Diagnose why tracing failed</span>
<a id="__codelineno-12-177" name="__codelineno-12-177" href="#__codelineno-12-177"></a>    <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-178" name="__codelineno-12-178" href="#__codelineno-12-178"></a>        <span class="n">traj</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-179" name="__codelineno-12-179" href="#__codelineno-12-179"></a>        <span class="n">dist_to_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">target_eq</span><span class="p">)</span>
<a id="__codelineno-12-180" name="__codelineno-12-180" href="#__codelineno-12-180"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tracing failed with status &#39;</span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-181" name="__codelineno-12-181" href="#__codelineno-12-181"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trajectory reached distance </span><span class="si">{</span><span class="n">dist_to_B</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> from target_eq.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-182" name="__codelineno-12-182" href="#__codelineno-12-182"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This exceeds hit_radius=</span><span class="si">{</span><span class="n">hit_radius</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-183" name="__codelineno-12-183" href="#__codelineno-12-183"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider increasing hit_radius or tightening finder tolerances.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-184" name="__codelineno-12-184" href="#__codelineno-12-184"></a>
<a id="__codelineno-12-185" name="__codelineno-12-185" href="#__codelineno-12-185"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
<a id="__codelineno-12-186" name="__codelineno-12-186" href="#__codelineno-12-186"></a>    <span class="c1"># Diagnose why tracing failed</span>
<a id="__codelineno-12-187" name="__codelineno-12-187" href="#__codelineno-12-187"></a>    <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-188" name="__codelineno-12-188" href="#__codelineno-12-188"></a>        <span class="n">traj</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-12-189" name="__codelineno-12-189" href="#__codelineno-12-189"></a>        <span class="n">dist_to_B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">target_eq</span><span class="p">)</span>
<a id="__codelineno-12-190" name="__codelineno-12-190" href="#__codelineno-12-190"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tracing failed with status &#39;</span><span class="si">{</span><span class="n">trace</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-191" name="__codelineno-12-191" href="#__codelineno-12-191"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trajectory reached distance </span><span class="si">{</span><span class="n">dist_to_B</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> from target_eq.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-192" name="__codelineno-12-192" href="#__codelineno-12-192"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This exceeds hit_radius=</span><span class="si">{</span><span class="n">hit_radius</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-193" name="__codelineno-12-193" href="#__codelineno-12-193"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider increasing hit_radius or tightening finder tolerances.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-194" name="__codelineno-12-194" href="#__codelineno-12-194"></a>
<a id="__codelineno-12-195" name="__codelineno-12-195" href="#__codelineno-12-195"></a><span class="c1"># Only plot if we have valid trajectory data</span>
<a id="__codelineno-12-196" name="__codelineno-12-196" href="#__codelineno-12-196"></a><span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">branch_pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-197" name="__codelineno-12-197" href="#__codelineno-12-197"></a>    <span class="n">theme</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>
<a id="__codelineno-12-198" name="__codelineno-12-198" href="#__codelineno-12-198"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">single</span><span class="p">()</span>
<a id="__codelineno-12-199" name="__codelineno-12-199" href="#__codelineno-12-199"></a>
<a id="__codelineno-12-200" name="__codelineno-12-200" href="#__codelineno-12-200"></a>    <span class="c1"># Add title indicating whether full heteroclinic connection was achieved</span>
<a id="__codelineno-12-201" name="__codelineno-12-201" href="#__codelineno-12-201"></a>    <span class="n">title_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="s2">&quot; (partial, did not reach B within hit_radius)&quot;</span>
<a id="__codelineno-12-202" name="__codelineno-12-202" href="#__codelineno-12-202"></a>
<a id="__codelineno-12-203" name="__codelineno-12-203" href="#__codelineno-12-203"></a>    <span class="n">manifold</span><span class="p">(</span>
<a id="__codelineno-12-204" name="__codelineno-12-204" href="#__codelineno-12-204"></a>        <span class="n">result</span><span class="o">=</span><span class="n">trace</span><span class="p">,</span>
<a id="__codelineno-12-205" name="__codelineno-12-205" href="#__codelineno-12-205"></a>        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<a id="__codelineno-12-206" name="__codelineno-12-206" href="#__codelineno-12-206"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
<a id="__codelineno-12-207" name="__codelineno-12-207" href="#__codelineno-12-207"></a>        <span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
<a id="__codelineno-12-208" name="__codelineno-12-208" href="#__codelineno-12-208"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Wu(A)&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; → B&quot;</span> <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">success</span> <span class="k">else</span> <span class="s2">&quot; (incomplete)&quot;</span><span class="p">),</span>
<a id="__codelineno-12-209" name="__codelineno-12-209" href="#__codelineno-12-209"></a>        <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
<a id="__codelineno-12-210" name="__codelineno-12-210" href="#__codelineno-12-210"></a>        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
<a id="__codelineno-12-211" name="__codelineno-12-211" href="#__codelineno-12-211"></a>        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">,</span>
<a id="__codelineno-12-212" name="__codelineno-12-212" href="#__codelineno-12-212"></a>        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
<a id="__codelineno-12-213" name="__codelineno-12-213" href="#__codelineno-12-213"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Heteroclinic orbit at c=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">param_found</span><span class="si">:</span><span class="s2">.10f</span><span class="si">}{</span><span class="n">title_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-12-214" name="__codelineno-12-214" href="#__codelineno-12-214"></a>        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span>
<a id="__codelineno-12-215" name="__codelineno-12-215" href="#__codelineno-12-215"></a>    <span class="p">)</span>
<a id="__codelineno-12-216" name="__codelineno-12-216" href="#__codelineno-12-216"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">source_eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">source_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<a id="__codelineno-12-217" name="__codelineno-12-217" href="#__codelineno-12-217"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">target_eq</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">target_eq</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<a id="__codelineno-12-218" name="__codelineno-12-218" href="#__codelineno-12-218"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">x_u_cross</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">x_u_cross</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross (Wu)&quot;</span><span class="p">)</span>
<a id="__codelineno-12-219" name="__codelineno-12-219" href="#__codelineno-12-219"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">x_s_cross</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">miss</span><span class="o">.</span><span class="n">x_s_cross</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cross (Ws)&quot;</span><span class="p">)</span>
<a id="__codelineno-12-220" name="__codelineno-12-220" href="#__codelineno-12-220"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<a id="__codelineno-12-221" name="__codelineno-12-221" href="#__codelineno-12-221"></a>
<a id="__codelineno-12-222" name="__codelineno-12-222" href="#__codelineno-12-222"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-223" name="__codelineno-12-223" href="#__codelineno-12-223"></a><span class="sd">    cross (Wu) (or x_u_cross): This is the point where the unstable manifold (Wu) of</span>
<a id="__codelineno-12-224" name="__codelineno-12-224" href="#__codelineno-12-224"></a><span class="sd">    equilibrium point A crosses a section plane centered at equilibrium point B.</span>
<a id="__codelineno-12-225" name="__codelineno-12-225" href="#__codelineno-12-225"></a>
<a id="__codelineno-12-226" name="__codelineno-12-226" href="#__codelineno-12-226"></a><span class="sd">    cross (Ws) (or x_s_cross): This is the point where the stable manifold (Ws) of</span>
<a id="__codelineno-12-227" name="__codelineno-12-227" href="#__codelineno-12-227"></a><span class="sd">    equilibrium point B crosses the same section plane.</span>
<a id="__codelineno-12-228" name="__codelineno-12-228" href="#__codelineno-12-228"></a>
<a id="__codelineno-12-229" name="__codelineno-12-229" href="#__codelineno-12-229"></a><span class="sd">    When a heteroclinic orbit exists, these two crossing points should be very close</span>
<a id="__codelineno-12-230" name="__codelineno-12-230" href="#__codelineno-12-230"></a><span class="sd">    (ideally the same point), meaning the unstable manifold of A connects to the stable</span>
<a id="__codelineno-12-231" name="__codelineno-12-231" href="#__codelineno-12-231"></a><span class="sd">    manifold of B. The algorithm searches for parameter values where this &quot;miss distance&quot;</span>
<a id="__codelineno-12-232" name="__codelineno-12-232" href="#__codelineno-12-232"></a><span class="sd">    is minimized.</span>
<a id="__codelineno-12-233" name="__codelineno-12-233" href="#__codelineno-12-233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-234" name="__codelineno-12-234" href="#__codelineno-12-234"></a>
<a id="__codelineno-12-235" name="__codelineno-12-235" href="#__codelineno-12-235"></a>    <span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-12-236" name="__codelineno-12-236" href="#__codelineno-12-236"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-237" name="__codelineno-12-237" href="#__codelineno-12-237"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No trajectory data to plot.&quot;</span><span class="p">)</span>
</code></pre></div>
Each script runs the corresponding finder/tracer pair on an inline 2D model. They demonstrate the simplified API (<code>preset</code>, tuple-style <code>window</code>, optional <code>x_tol</code>/<code>gap_tol</code>), print finder diagnostics (gap size, status), and plot the traced orbit in the return section so you can visualize whether the unstable manifold connects back.</p>
<h2 id="sweeps-and-trajectory-helpers">Sweeps and trajectory helpers</h2>
<h3 id="parameter-sweeps">Parameter sweeps</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">series</span><span class="p">,</span> <span class="n">export</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib.analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">sweep</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">DSL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="s2">inline:</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="s2">[model]</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="s2">type=&quot;ode&quot;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="s2">[states]</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="s2">x=10.0</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="s2">[params]</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="s2">a=-1.0</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="s2">[equations.rhs]</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="s2">x = &quot;a * x&quot;</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">DSL</span><span class="p">,</span> 
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>            <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>            <span class="n">disk_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="n">res</span><span class="o">=</span><span class="n">sweep</span><span class="o">.</span><span class="n">traj_sweep</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">record_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="c1"># Plot all trajectories at once (stacked access)</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="n">series</span><span class="o">.</span><span class="n">multi</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="n">export</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="c1"># Access individual runs for custom processing</span>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sweep has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">runs</span><span class="p">)</span><span class="si">}</span><span class="s2"> runs:&quot;</span><span class="p">)</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">runs</span><span class="p">:</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>    <span class="n">final_x</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  a=</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">param_value</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">: x(T)=</span><span class="si">{</span><span class="n">final_x</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="c1"># Access a specific run</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="n">run</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Third run (a=-3.0)</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Run details for a=</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">param_value</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Initial x: </span><span class="si">{</span><span class="n">run</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Final x: </span><span class="si">{</span><span class="n">run</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
Uses <code>analysis.sweep.traj_sweep</code> to run the toy ODE <code>x' = a x</code> for several <code>a</code> values, stacks the trajectories with <code>series.multi</code>, and accesses each <code>SweepRun</code> to print the final state and step details.</p>
<h3 id="trajectory-analyzer">Trajectory analyzer</h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="sd">&quot;&quot;&quot;Demonstration of TrajectoryAnalyzer helpers on a damped oscillator.&quot;&quot;&quot;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dynlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="n">MODEL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="s2">inline:</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="s2">[model]</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="s2">type=&quot;ode&quot;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="s2">name=&quot;Damped oscillator with aux energy&quot;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="s2">[states]</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="s2">x=1.0</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="s2">v=0.0</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="s2">[params]</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="s2">omega=2.0</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="s2">zeta=0.15</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="s2">[equations.rhs]</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="s2">x = &quot;v&quot;</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="s2">v = &quot;-2*zeta*omega*v - omega**2 * x&quot;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="s2">[aux]</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="s2">energy = &quot;0.5 * (v**2 + (omega * x)**2)&quot;</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">_round_dict</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>    <span class="n">sim</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">MODEL</span><span class="p">,</span> <span class="n">stepper</span><span class="o">=</span><span class="s2">&quot;rk4&quot;</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disk_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>    <span class="n">sim</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">max_steps</span><span class="o">=</span><span class="mi">150_000</span><span class="p">)</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>    <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">record_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;aux.energy&quot;</span><span class="p">])</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Single-variable analysis (x) ---&quot;</span><span class="p">)</span>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;summary:&quot;</span><span class="p">,</span> <span class="n">_round_dict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">summary</span><span class="p">()))</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>    <span class="n">t_peak</span><span class="p">,</span> <span class="n">peak</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;peak x at t=</span><span class="si">{</span><span class="n">t_peak</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">peak</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>    <span class="n">crossings</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">zero_crossings</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;up&quot;</span><span class="p">)</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first three zero up-crossings (s):&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">crossings</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time with x &gt;= 0.5: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">time_above</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time with x &lt; -0.5: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">time_below</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Multi-variable analysis (x, v) ---&quot;</span><span class="p">)</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>    <span class="n">mv</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">analyze</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;argmax by var:&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mv</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;range by var:&quot;</span><span class="p">,</span> <span class="n">_round_dict</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">range</span><span class="p">()))</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean by var:&quot;</span><span class="p">,</span> <span class="n">_round_dict</span><span class="p">(</span><span class="n">mv</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Aux variable analysis (energy) ---&quot;</span><span class="p">)</span>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a>    <span class="n">energy</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">)</span>  <span class="c1"># auto-detected aux without explicit prefix</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;energy min/max:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)))</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;energy range:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">range</span><span class="p">(),</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>    <span class="n">below_times</span> <span class="o">=</span> <span class="n">energy</span><span class="o">.</span><span class="n">crossing_times</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;down&quot;</span><span class="p">)</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;first drop below 0.1:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">below_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">below_times</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;never&quot;</span><span class="p">)</span>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Automatic variable selection ---&quot;</span><span class="p">)</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>    <span class="n">auto</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">analyze</span><span class="p">()</span>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;recorded vars picked by res.analyze():&quot;</span><span class="p">,</span> <span class="n">auto</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
Runs a damped oscillator with an auxiliary energy variable, then calls <code>res.analyze()</code> to show <code>summary()</code>, <code>argmax()</code>, <code>zero_crossings()</code>, and <code>time_above/Below</code> for single- and multi-variable selections. It also inspects the automatically selected auxiliary variables to demonstrate how <code>TrajectoryAnalyzer</code> finds recorded names.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ismoz/dynlib" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/dynlib/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.math"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>